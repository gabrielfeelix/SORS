import{d as J,c,h as _,z as Q,p as U,g as r,f as C,a as R,b as m,D as W,E as X,w as D,e,i as M,o,l as z,n as f,t as d,j,F as V,r as L,k as P,G as ee,H as te,C as se}from"./app-DvJ-vTb0.js";import{u as ae,_ as le}from"./useIsMobile-CMH_TBsk.js";import{_ as ie,r as ne}from"./DesktopShell.vue_vue_type_script_setup_true_lang-BVoVaQ94.js";import{_ as oe}from"./CreateCreditCardFlowModal.vue_vue_type_script_setup_true_lang-lP2gGW5r.js";import{_ as re}from"./MonthNavigator.vue_vue_type_script_setup_true_lang-BF8bI4Ys.js";import"./inputGuards-BTKUKM9N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const de={key:0,class:"flex items-center justify-between px-6 pt-4 pb-8"},ue={class:"rounded-3xl bg-[#1E293B] p-6 shadow-xl"},ce={key:0,class:"mt-3 h-10 w-48 animate-pulse rounded-lg bg-white/10"},me={key:1,class:"mt-3 text-[32px] font-bold leading-none text-white"},pe={key:2,class:"mt-6 grid grid-cols-2 gap-6"},ve={key:3,class:"mt-6 grid grid-cols-2 gap-6"},he={class:"mt-1 flex items-center gap-2"},xe={class:"text-xl font-bold text-[#14B8A6] whitespace-nowrap"},fe={class:"h-1.5 flex-1 overflow-hidden rounded-full bg-[#334155]"},ge={class:"mt-1 text-xl font-bold text-white"},we={class:"flex items-center justify-between"},be={class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},ye={class:"p-4"},ke={class:"flex items-start gap-3"},_e={class:"flex-1 min-w-0"},Ce={class:"text-base font-bold text-slate-900"},De={class:"mt-1 flex flex-wrap items-center gap-1 text-[11px] font-semibold text-slate-500"},Me={key:0,class:"inline-flex items-center rounded-md bg-slate-100 px-2 py-0.5 uppercase tracking-wide text-slate-500"},Be={class:"text-right"},Se={class:"text-base font-bold text-slate-900"},Ae={class:"mt-3 space-y-2"},$e={class:"flex items-center justify-between text-[11px] font-medium text-slate-500"},Ne={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100"},Fe={class:"mt-3 flex items-center justify-between text-[11px] font-semibold text-slate-500"},je={class:"flex flex-wrap items-center gap-4"},Ve=["title"],Ee=["title"],Ie={key:2,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-8 text-center"},Oe=J({__name:"MyCards",setup(Ue){const p=ae(),T=c(()=>p.value?le:ie),K=c(()=>p.value?{showNav:!1}:{title:"Meus Cartões",subtitle:"Cartões de crédito",showSearch:!1,showNewAction:!1}),k=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a),G=a=>a.toLocaleString("pt-BR",{minimumFractionDigits:1,maximumFractionDigits:1})+"%",B=c(()=>{const a=new Date,t=[];for(let s=-2;s<=2;s+=1){const l=new Date(a.getFullYear(),a.getMonth()+s,1),i=new Intl.DateTimeFormat("pt-BR",{month:"short"}).format(l).replace(".","").toUpperCase();t.push({key:`${l.getFullYear()}-${l.getMonth()}`,label:i,date:l})}return t}),v=_(""),g=_(new Map),w=_(new Set);Q(()=>{v.value=B.value[2]?.key??B.value[0]?.key??""}),U(v,a=>{a&&E(a)},{immediate:!0});const E=async a=>{const t=`cards-${a}`;if(g.value.delete(t),!w.value.has(t)){w.value.add(t);try{const[s,l]=a.split("-").map(Number),i=await ne(`/api/cartoes-by-month?year=${s}&month=${l}`,{method:"GET"});g.value.set(t,Array.isArray(i?.cartoes)?i.cartoes:[])}catch(s){console.error("Failed to load credit cards for month",s),g.value.set(t,[])}finally{w.value.delete(t)}}},S=c(()=>{const a=v.value;if(!a)return!1;const t=`cards-${a}`;return w.value.has(t)}),h=c(()=>{const a=v.value;if(!a)return[];const t=`cards-${a}`;if(w.value.has(t))return[];const s=g.value.get(t)??[];return g.value.has(t)?s.map(l=>{const i=Number(l.credit_limit??l.limite??0),n=Math.max(0,Number(l.current_balance??l.limite_usado??0)),x=i>0?n/i*100:0,N=i-n;let y="PAGA";return n>=i?y="ATRASADA":n>0&&(y="ABERTA"),{id:l.id,nome:l.name||l.nome,bandeira:l.bandeira??l.card_brand??null,fechamentoDia:Number(l.dia_fechamento??l.closing_day??0)||null,vencimentoDia:Number(l.dia_vencimento??l.due_day??0)||null,cor:(l.color||l.cor)??"#8B5CF6",limite:i,usado:n,disponivel:Math.max(0,N),percentualUsado:x,status:y}}):[]}),H=c(()=>{const a=i=>String(i??"").trim().toLowerCase(),t=new Map;for(const i of h.value){const n=a(i.nome),x=t.get(n)??[];x.push(i),t.set(n,x)}const s=[];for(const i of t.values()){if(i.length===1){s.push({...i[0],displayName:i[0].nome});continue}const n=[...i].sort((u,F)=>String(u.id).localeCompare(String(F.id))),x=new Set(n.map(u=>String(u.bandeira??"").toLowerCase())).size>1,N=new Set(n.map(u=>u.vencimentoDia??null)).size>1,y=new Set(n.map(u=>u.fechamentoDia??null)).size>1;n.forEach((u,F)=>{const q=x||N||y?u.nome:`${u.nome} (${F+1})`;s.push({...u,displayName:q})})}const l=new Map(h.value.map((i,n)=>[String(i.id),n]));return s.sort((i,n)=>(l.get(String(i.id))??0)-(l.get(String(n.id))??0))});U(()=>v.value,a=>{a&&E(a)});const A=c(()=>h.value.reduce((a,t)=>a+t.usado,0)),$=c(()=>h.value.reduce((a,t)=>a+t.limite,0)),I=c(()=>$.value===0?0:A.value/$.value*100),O=c(()=>Math.max(0,$.value-A.value)),Y=a=>a==="PAGA"?"bg-emerald-50 text-emerald-600":a==="ATRASADA"?"bg-red-50 text-red-500":"bg-amber-50 text-amber-600",b=_(!1),Z=()=>{b.value=!1,window.location.reload()};return(a,t)=>(o(),r(V,null,[C(m(W),{title:"Meus Cartões"}),(o(),R(se(T.value),ee(te(K.value)),X({default:D(()=>[m(p)?(o(),r("header",de,[C(m(z),{href:a.route("dashboard"),class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Voltar"},{default:D(()=>[...t[5]||(t[5]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])]),_:1},8,["href"]),t[7]||(t[7]=e("div",{class:"text-center"},[e("div",{class:"text-lg font-semibold text-slate-900"},"Meus Cartões")],-1)),e("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Adicionar cartão",onClick:t[1]||(t[1]=s=>b.value=!0)},[...t[6]||(t[6]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])])):M("",!0),e("div",{class:f(m(p)?"px-6 pb-6":"pb-6")},[C(re,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),months:B.value},null,8,["modelValue","months"])],2),e("div",{class:f(m(p)?"px-6":"")},[e("div",ue,[t[11]||(t[11]=e("div",{class:"flex items-start justify-between"},[e("div",{class:"text-[10px] font-semibold uppercase tracking-wider text-[#64748B]"}," Dívida Consolidada "),e("div",{class:"flex h-6 w-6 items-center justify-center"},[e("svg",{class:"h-4 w-4 text-white/30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e("line",{x1:"3",y1:"18",x2:"21",y2:"18"})])])],-1)),S.value?(o(),r("div",ce)):(o(),r("div",me,d(k(A.value)),1)),S.value?(o(),r("div",pe,[...t[8]||(t[8]=[e("div",null,[e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Uso de Crédito "),e("div",{class:"mt-1 flex items-center gap-2"},[e("div",{class:"h-7 w-16 animate-pulse rounded bg-white/10"}),e("div",{class:"h-1.5 flex-1 animate-pulse rounded-full bg-[#334155]"})])],-1),e("div",null,[e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Disp. Consolidado "),e("div",{class:"mt-1 h-7 w-32 animate-pulse rounded bg-white/10"})],-1)])])):(o(),r("div",ve,[e("div",null,[t[9]||(t[9]=e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Uso de Crédito ",-1)),e("div",he,[e("div",xe,d(G(I.value)),1),e("div",fe,[e("div",{class:"h-full bg-[#14B8A6] transition-all",style:j({width:`${Math.min(100,I.value)}%`})},null,4)])])]),e("div",null,[t[10]||(t[10]=e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Disp. Consolidado ",-1)),e("div",ge,d(k(O.value)),1)])]))])],2),e("div",{class:f(m(p)?"mt-8 px-6":"mt-10")},[e("div",we,[t[12]||(t[12]=e("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-900"}," Cartões ",-1)),e("div",be,d(h.value.length)+" UNIDADES ",1)]),S.value?(o(),r("div",{key:0,class:f(m(p)?"mt-4 space-y-3 pb-8":"mt-5 grid grid-cols-2 gap-4 pb-10 xl:grid-cols-3")},[(o(),r(V,null,L(3,s=>e("div",{key:s,class:"overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200/60"},[...t[13]||(t[13]=[e("div",{class:"p-4"},[e("div",{class:"flex items-start gap-3"},[e("div",{class:"h-12 w-12 shrink-0 animate-pulse rounded-2xl bg-slate-200"}),e("div",{class:"flex-1 min-w-0"},[e("div",{class:"h-5 w-32 animate-pulse rounded bg-slate-200"}),e("div",{class:"mt-2 flex gap-1"},[e("div",{class:"h-5 w-12 animate-pulse rounded-md bg-slate-100"}),e("div",{class:"h-5 w-8 animate-pulse rounded-md bg-slate-100"}),e("div",{class:"h-5 w-8 animate-pulse rounded-md bg-slate-100"})])]),e("div",{class:"text-right"},[e("div",{class:"h-5 w-20 animate-pulse rounded bg-slate-200"}),e("div",{class:"mt-1 h-5 w-16 animate-pulse rounded-md bg-slate-100"})])]),e("div",{class:"mt-3 flex items-center justify-between"},[e("div",{class:"h-4 w-32 animate-pulse rounded bg-slate-100"}),e("div",{class:"h-4 w-24 animate-pulse rounded bg-slate-100"})])],-1)])])),64))],2)):h.value.length?(o(),r("div",{key:1,class:f(m(p)?"mt-4 space-y-3 pb-8":"mt-5 grid grid-cols-2 gap-4 pb-10 xl:grid-cols-3")},[(o(!0),r(V,null,L(H.value,s=>(o(),R(m(z),{key:s.id,href:a.route("credit-cards.show",{account:s.id}),class:"block overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200/60"},{default:D(()=>[e("div",ye,[e("div",ke,[e("div",{class:"flex h-12 w-12 shrink-0 items-center justify-center rounded-2xl",style:j({backgroundColor:s.cor})},[...t[14]||(t[14]=[e("svg",{class:"h-6 w-6 text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2"}),e("line",{x1:"2",y1:"10",x2:"22",y2:"10"})],-1)])],4),e("div",_e,[e("div",Ce,d(s.displayName),1),e("div",De,[s.bandeira?(o(),r("span",Me,d(String(s.bandeira)),1)):M("",!0)])]),e("div",Be,[e("div",Se,d(k(s.usado)),1),e("div",{class:f(["mt-1 inline-block rounded-md px-2 py-0.5 text-[10px] font-bold uppercase tracking-wide",Y(s.status)])},d(s.status),3)])]),e("div",Ae,[e("div",$e,[e("span",null,"LIMITE USADO: "+d(Math.round(s.percentualUsado))+"%",1),e("span",null,"DISP: "+d(k(s.disponivel)),1)]),e("div",Ne,[e("div",{class:"h-full rounded-full transition-all duration-300",style:j({width:`${Math.min(s.percentualUsado,100)}%`,backgroundColor:s.cor})},null,4)]),e("div",Fe,[e("div",je,[s.fechamentoDia?(o(),r("span",{key:0,class:"inline-flex items-center gap-1",title:`Fechamento dia ${s.fechamentoDia}`},[t[15]||(t[15]=e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 2v4"}),e("path",{d:"M16 2v4"}),e("path",{d:"M3 10h18"}),e("path",{d:"M5 6h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"})],-1)),P(" FECHA DIA "+d(String(s.fechamentoDia).padStart(2,"0")),1)],8,Ve)):M("",!0),s.vencimentoDia?(o(),r("span",{key:1,class:"inline-flex items-center gap-1",title:`Vencimento dia ${s.vencimentoDia}`},[t[16]||(t[16]=e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 2v4"}),e("path",{d:"M16 2v4"}),e("path",{d:"M3 10h18"}),e("path",{d:"M5 6h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"}),e("path",{d:"M12 14v4"}),e("path",{d:"M12 12h.01"})],-1)),P(" VENCE DIA "+d(String(s.vencimentoDia).padStart(2,"0")),1)],8,Ee)):M("",!0)])])])])]),_:2},1032,["href"]))),128))],2)):(o(),r("div",Ie,[...t[17]||(t[17]=[e("div",{class:"text-sm font-semibold text-slate-900"},"Nenhum cartão cadastrado",-1),e("div",{class:"mt-1 text-xs text-slate-500"},"Adicione um cartão para começar",-1)])]))],2),C(oe,{open:b.value,onClose:t[3]||(t[3]=s=>b.value=!1),onSave:Z},null,8,["open"])]),_:2},[m(p)?void 0:{name:"headerActions",fn:D(()=>[e("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Adicionar cartão",onClick:t[0]||(t[0]=s=>b.value=!0)},[...t[4]||(t[4]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),key:"0"}]),1040))],64))}});export{Oe as default};
