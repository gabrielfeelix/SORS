import{d as ve,u as fe,c as n,h as m,a as xe,w as K,e as t,f as b,g as i,i as he,b as q,o as l,l as pe,t as c,F as _,r as M,j,n as J,k as U,B as ge,C as be,m as we}from"./app-DVrDHbGt.js";import{_ as ye,a as ke,r as _e}from"./DesktopShell.vue_vue_type_script_setup_true_lang-dSkPFJXH.js";import{_ as Me,T as Ce,e as De,h as Q,b as Be,a as Fe}from"./TransactionModal-CNbB9n8F.js";import{u as $e,_ as Te}from"./useIsMobile-BrGiTvVM.js";import{_ as Ne}from"./ExportReportModal.vue_vue_type_script_setup_true_lang-Dujpq9wB.js";import{_ as Se}from"./MobileToast.vue_vue_type_script_setup_true_lang-CxgnS5hK.js";import"./inputGuards-BV9ov3X1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./AccountPickerSheet.vue_vue_type_script_setup_true_lang-DZoClzjL.js";const je={class:"flex items-center justify-between pt-2"},Ee={key:0},Ae={class:"flex items-center gap-4"},Le={class:"mt-1 text-xs font-semibold text-slate-500"},Re={class:"mt-5 rounded-2xl bg-white px-3 py-3 shadow-sm ring-1 ring-slate-200/60"},Pe={class:"flex items-center justify-between"},Ie={class:"text-sm font-semibold tracking-wide text-slate-900"},Ve={class:"mt-4 overflow-hidden rounded-3xl bg-white shadow-sm ring-1 ring-slate-200/60"},Ye={class:"grid grid-cols-3 divide-x divide-slate-100"},Oe={class:"px-4 py-4 text-center"},ze={class:"mt-2 text-sm font-semibold text-emerald-600"},Ke={class:"px-4 py-4 text-center"},qe={class:"mt-2 text-sm font-semibold text-red-500"},Je={class:"px-4 py-4 text-center"},Ue={class:"mt-2 text-sm font-semibold text-emerald-600"},Qe={class:"mt-4 rounded-3xl bg-white p-5 shadow-sm ring-1 ring-slate-200/60"},We={key:0},Ge={class:"mt-6 flex items-center justify-center"},He={class:"relative h-52 w-52"},Xe={class:"h-full w-full -rotate-90",viewBox:"0 0 160 160"},Ze=["r","stroke","stroke-dasharray","stroke-dashoffset"],et={class:"absolute inset-0 flex flex-col items-center justify-center text-center"},tt={class:"text-3xl font-semibold text-slate-900"},st={class:"mt-5 space-y-3"},ot={class:"flex-1 text-sm font-semibold text-slate-600"},at={class:"text-sm font-semibold text-slate-900"},nt={class:"w-12 text-right text-xs font-semibold text-slate-400"},lt={key:1,class:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},rt={class:"mt-4 rounded-3xl bg-white p-5 shadow-sm ring-1 ring-slate-200/60"},it={key:0},ct={class:"mt-5 grid grid-cols-3 items-end gap-4"},dt={class:"text-xs font-semibold text-slate-400"},ut={class:"mt-4 text-sm font-semibold text-slate-400"},mt={class:"text-red-500"},vt={key:1,class:"mt-5 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},ft={class:"mt-5 pb-4"},xt={key:0,class:"mt-4 space-y-4"},ht={class:"flex items-center justify-between text-sm font-semibold"},pt={class:"flex min-w-0 items-center gap-2 text-slate-900"},gt={class:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-slate-100 text-slate-600"},bt={class:"truncate"},wt={class:"text-slate-900"},yt={class:"mt-2 h-2 w-full rounded-full bg-slate-100"},kt={key:1,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},jt=ve({__name:"Analysis",setup(_t){const W=fe(),f=n(()=>W.props.bootstrap??{entries:[],goals:[],accounts:[],categories:[],tags:[]}),w=n(()=>f.value.entries??[]),y=o=>{const e=String(o??"").trim().match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!e)return null;const[,s,a,r]=e,u=new Date(Number(s),Number(a)-1,Number(r));return Number.isFinite(u.getTime())?u:null},E=o=>new Intl.DateTimeFormat("pt-BR",{month:"short",year:"numeric"}).format(o).replace(".","").toUpperCase(),G=n(()=>{const o=new Map;for(const e of f.value.categories??[]){const s=e.type==="income"?"income":e.type==="expense"?"expense":void 0,a=o.get(e.name),r=a?.kind&&s&&a.kind!==s?void 0:a?.kind??s;o.set(e.name,{key:e.name,label:e.name,icon:e.icon??"other",tone:"slate",customColor:e.color??void 0,kind:r})}return Array.from(o.values())}),H=n(()=>{const o=s=>{const a=s.toLowerCase();return a.includes("nubank")?"purple":a.includes("inter")?"amber":a.includes("carteira")||a.includes("dinheiro")?"emerald":"slate"},e=[];for(const s of f.value.accounts??[])s.type!=="credit_card"&&e.push({key:s.name,label:s.name,subtitle:s.type==="wallet"?"Carteira":"Conta",tone:o(s.name),type:s.type,balance:Number(s.current_balance??0),customColor:s.color??void 0,icon:s.icon??void 0});for(const s of f.value.accounts??[]){if(s.type!=="credit_card")continue;const a=Number(s.credit_limit??0),r=Math.max(0,Number(s.current_balance??0));e.push({key:s.name,label:s.name,subtitle:"Cartão de Crédito",tone:o(s.name),type:"credit_card",limit:a,used:r,available:a-r,customColor:s.color??void 0,icon:s.icon??void 0})}return e}),C=o=>`${o.getFullYear()}-${o.getMonth()}`,A=o=>`${o.getFullYear()}`,d=m(new Date),L=m("month"),R=n(()=>`${new Intl.DateTimeFormat("pt-BR",{month:"long"}).format(d.value).toUpperCase()} ${d.value.getFullYear()}`),D=$e(),X=n(()=>D.value?Te:ye),Z=n(()=>D.value?{showNav:!0}:{title:"Relatórios",subtitle:R.value,searchPlaceholder:"Buscar transação…",newActionLabel:"Nova Transação",showSearch:!1}),P=o=>{const e=new Date(d.value);e.setMonth(e.getMonth()+o),d.value=e},x=n(()=>{if(!w.value.length)return[];if(L.value==="month"){const o=C(d.value);return w.value.filter(e=>{if(!e.transactionDate)return!1;const s=y(e.transactionDate)??new Date(e.transactionDate);return C(s)===o})}if(L.value==="year"){const o=A(d.value);return w.value.filter(e=>{if(!e.transactionDate)return!1;const s=y(e.transactionDate)??new Date(e.transactionDate);return A(s)===o})}return w.value.filter(o=>{if(!o.transactionDate)return!1;const e=y(o.transactionDate)??new Date(o.transactionDate),s=(d.value.getFullYear()-e.getFullYear())*12+(d.value.getMonth()-e.getMonth());return s>=0&&s<3})}),v=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0}).format(o),I=n(()=>x.value.filter(o=>o.kind==="income").reduce((o,e)=>o+e.amount,0)),B=n(()=>x.value.filter(o=>o.kind==="expense").reduce((o,e)=>o+e.amount,0)),ee=n(()=>I.value-B.value),V=o=>String(o??"").trim().toLowerCase(),te=n(()=>{const o=new Map;for(const e of f.value.categories??[])o.set(`${V(e.name)}|${e.type}`,e.icon??"other");return o}),se=o=>{const e=String(o.categoryKey??"").toLowerCase();return e==="food"?"cart":e==="home"?"home":e==="car"?"car":"other"},F=n(()=>{const o=["#14B8A6","#3B82F6","#F59E0B","#10B981","#EF4444","#8B5CF6"],e=new Map;for(const s of x.value){if(s.kind!=="expense")continue;const a=s.categoryLabel||"Outros";e.set(a,(e.get(a)??0)+s.amount)}return Array.from(e.entries()).map(([s,a],r)=>({key:s.toLowerCase().replace(/\s+/g,"-"),label:s,value:a,color:o[r%o.length]}))}),h=n(()=>F.value.reduce((o,e)=>o+e.value,0)),Y=n(()=>F.value.map(o=>({...o,pct:h.value?Math.round(o.value/h.value*100):0}))),oe=n(()=>{const e=2*Math.PI*64;let s=0;return Y.value.map(a=>{const r=h.value?a.value/h.value:0,u=e*r,g={...a,radius:64,circumference:e,dasharray:`${u} ${e-u}`,dashoffset:-s};return s+=u,g})}),p=n(()=>{const o=new Date(d.value),e=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],s=Array.from({length:3},(a,r)=>{const u=new Date(o.getFullYear(),o.getMonth()-(2-r),1);return{key:`${u.getFullYear()}-${u.getMonth()+1}`,label:e[u.getMonth()],value:0,highlight:r===2}});for(const a of x.value){if(!a.transactionDate)continue;const r=y(a.transactionDate)??new Date(a.transactionDate),u=`${r.getFullYear()}-${r.getMonth()+1}`,g=s.find(me=>me.key===u);g&&(g.value+=a.kind==="expense"?a.amount:0)}return s}),ae=n(()=>Math.max(...p.value.map(o=>o.value),1)),ne=n(()=>{const o=p.value.at(-1)?.value??0,e=p.value.at(-2)?.value??0;return e?Math.round((o-e)/e*1e3)/10:0}),$=n(()=>{const o=["#3B82F6","#F59E0B","#EF4444","#8B5CF6","#10B981"];return x.value.filter(e=>e.kind==="expense").sort((e,s)=>s.amount-e.amount).slice(0,5).map((e,s)=>({key:e.id,label:e.title,categoryIcon:te.value.get(`${V(e.categoryLabel)}|expense`)??se(e),value:e.amount,color:o[s%o.length]}))}),le=n(()=>Math.max(...$.value.map(o=>o.value),1)),re=n(()=>F.value.length>0&&h.value>0),ie=n(()=>p.value.length>0),ce=n(()=>$.value.length>0),T=m(!1),O=m("expense");m(!1);const N=m(!1);m(!1);const S=m(!1),z=m(""),k=o=>{z.value=o,S.value=!0},de=()=>{O.value="expense",T.value=!0},ue=async o=>{if(o.kind==="transfer"){try{await De(o),k("Transferência realizada"),we.reload({only:["bootstrap"]})}catch{k("Não foi possível realizar a transferência")}return}await(Q(o)?ke:_e)(route("transactions.store"),{method:"POST",body:Q(o)?Be(o):JSON.stringify(Fe(o))}),k("Movimentação salva")};return(o,e)=>(l(),xe(be(X.value),ge(Z.value,{onAdd:de}),{default:K(()=>[t("header",je,[q(D)?(l(),i("div",Ee,[...e[7]||(e[7]=[t("div",{class:"text-2xl font-semibold tracking-tight text-slate-900"},"Relatórios",-1)])])):he("",!0),t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-500 shadow-sm ring-1 ring-slate-200/60","aria-label":"Exportar relatório",onClick:e[0]||(e[0]=s=>N.value=!0)},[...e[8]||(e[8]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v10"}),t("path",{d:"M8 9l4-4 4 4"}),t("path",{d:"M4 19h16"})],-1)])])]),b(q(pe),{href:o.route("analysis.compare"),class:"mt-6 flex items-center justify-between gap-4 rounded-2xl bg-[#E6FFFB] px-4 py-4 shadow-sm ring-1 ring-emerald-100"},{default:K(()=>[t("div",Ae,[e[10]||(e[10]=t("span",{class:"flex h-12 w-12 items-center justify-center rounded-2xl bg-[#14B8A6] text-white"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M7 7h10"}),t("path",{d:"M7 17h10"}),t("path",{d:"M10 10l-3-3 3-3"}),t("path",{d:"M14 14l3 3-3 3"})])],-1)),t("div",null,[e[9]||(e[9]=t("div",{class:"text-sm font-semibold text-slate-900"},"Comparar Períodos",-1)),t("div",Le,c(`${E(d.value)} vs ${E(new Date(d.value.getFullYear(),d.value.getMonth()-1,1))}`),1)])]),e[11]||(e[11]=t("svg",{class:"h-5 w-5 text-emerald-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1))]),_:1},8,["href"]),t("div",Re,[t("div",Pe,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-xl text-slate-500 hover:bg-slate-50","aria-label":"Mês anterior",onClick:e[1]||(e[1]=s=>P(-1))},[...e[12]||(e[12]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),t("div",Ie,c(R.value),1),t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-xl text-slate-500 hover:bg-slate-50","aria-label":"Próximo mês",onClick:e[2]||(e[2]=s=>P(1))},[...e[13]||(e[13]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1)])])])]),t("div",Ve,[t("div",Ye,[t("div",Oe,[e[14]||(e[14]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Receitas",-1)),t("div",ze,c(v(I.value)),1)]),t("div",Ke,[e[15]||(e[15]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Despesas",-1)),t("div",qe,c(v(B.value)),1)]),t("div",Je,[e[16]||(e[16]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Balanço",-1)),t("div",Ue,"+"+c(v(ee.value)),1)])])]),t("div",Qe,[e[20]||(e[20]=t("div",{class:"text-base font-semibold text-slate-900"},"Despesas por categoria",-1)),re.value?(l(),i("div",We,[t("div",Ge,[t("div",He,[(l(),i("svg",Xe,[e[17]||(e[17]=t("circle",{cx:"80",cy:"80",r:"64",stroke:"#E2E8F0","stroke-width":"18",fill:"none"},null,-1)),(l(!0),i(_,null,M(oe.value,s=>(l(),i("circle",{key:s.key,cx:"80",cy:"80",r:s.radius,stroke:s.color,"stroke-width":"18",fill:"none","stroke-linecap":"butt","stroke-dasharray":s.dasharray,"stroke-dashoffset":s.dashoffset},null,8,Ze))),128))])),t("div",et,[t("div",tt,c(v(B.value)),1),e[18]||(e[18]=t("div",{class:"mt-1 text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Total de despesas",-1))])])]),t("div",st,[(l(!0),i(_,null,M(Y.value,s=>(l(),i("div",{key:s.key,class:"flex items-center gap-3"},[t("span",{class:"h-3 w-3 rounded-full",style:j({backgroundColor:s.color})},null,4),t("div",ot,c(s.label),1),t("div",at,c(v(s.value)),1),t("div",nt,"("+c(s.pct)+"%)",1)]))),128))])])):(l(),i("div",lt,[...e[19]||(e[19]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 8v8"}),t("path",{d:"M8 12h8"}),t("circle",{cx:"12",cy:"12",r:"9"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Você ainda não possui despesas este mês.",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Adicione seus gastos para ver o gráfico.",-1)])]))]),t("div",rt,[e[24]||(e[24]=t("div",{class:"text-base font-semibold text-slate-900"},"Últimos 3 meses",-1)),ie.value?(l(),i("div",it,[t("div",ct,[(l(!0),i(_,null,M(p.value,s=>(l(),i("div",{key:s.key,class:"text-center"},[t("div",dt,c(v(s.value)),1),t("div",{class:J(["mx-auto mt-3 w-20 rounded-2xl",s.highlight?"bg-teal-500":"bg-slate-200"]),style:j({height:`${Math.max(28,Math.round(s.value/ae.value*96))}px`})},null,6),t("div",{class:J(["mt-2 text-xs font-semibold",s.highlight?"text-teal-600":"text-slate-400"])},c(s.label),3)]))),128))]),t("div",ut,[e[21]||(e[21]=U(" Aumento de ",-1)),t("span",mt,c(ne.value)+"%",1),e[22]||(e[22]=U(" em relação ao mês anterior ",-1))])])):(l(),i("div",vt,[...e[23]||(e[23]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 19V5"}),t("path",{d:"M10 19V9"}),t("path",{d:"M16 19v-4"}),t("path",{d:"M22 19V7"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Sem histórico ainda",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Seu gráfico aparece quando houver lançamentos.",-1)])]))]),t("div",ft,[e[26]||(e[26]=t("div",{class:"text-lg font-semibold text-slate-900"},"Top 5 gastos",-1)),ce.value?(l(),i("div",xt,[(l(!0),i(_,null,M($.value,s=>(l(),i("div",{key:s.key},[t("div",ht,[t("div",pt,[t("span",gt,[b(Me,{icon:s.categoryIcon,class:"h-4 w-4"},null,8,["icon"])]),t("span",bt,c(s.label),1)]),t("div",wt,c(v(s.value)),1)]),t("div",yt,[t("div",{class:"h-2 rounded-full",style:j({width:`${Math.round(s.value/le.value*100)}%`,backgroundColor:s.color})},null,4)])]))),128))])):(l(),i("div",kt,[...e[25]||(e[25]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"5",width:"18",height:"14",rx:"3"}),t("path",{d:"M3 10h18"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Sem gastos registrados",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Adicione lançamentos para preencher este ranking.",-1)])]))]),b(Ce,{open:T.value,kind:O.value,categories:G.value,accounts:H.value,tags:f.value.tags,onClose:e[3]||(e[3]=s=>T.value=!1),onSave:ue},null,8,["open","kind","categories","accounts","tags"]),b(Ne,{open:N.value,"default-month-key":C(d.value),onClose:e[4]||(e[4]=s=>N.value=!1),onExported:e[5]||(e[5]=({channel:s})=>{k(s==="download"?"Relatório baixado":"Relatório enviado por email")})},null,8,["open","default-month-key"]),b(Se,{show:S.value,message:z.value,onDismiss:e[6]||(e[6]=s=>S.value=!1)},null,8,["show","message"])]),_:1},16))}});export{jt as default};
