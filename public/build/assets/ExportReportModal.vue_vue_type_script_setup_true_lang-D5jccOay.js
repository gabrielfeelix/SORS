import{d as Y,h as p,c as _,p as H,g as d,i as f,e as t,t as m,n as i,s as j,x as $,y as R,k as K,F as P,r as q,o as u}from"./app-CbuCxuU_.js";const G={key:0,class:"fixed inset-0 z-[85] bg-white"},J={class:"mx-auto w-full max-w-md px-5 pb-[calc(7rem+env(safe-area-inset-bottom))]"},W={class:"mt-2 space-y-6"},Z={class:"text-sm font-semibold text-slate-900"},Q={class:"mt-3 space-y-3"},ee={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},te={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},se={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},oe={class:"mt-3 space-y-3"},le={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},ne={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},ae={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},re={class:"rounded-2xl bg-slate-50 p-4 ring-1 ring-slate-200/60"},ie={class:"flex items-center gap-4"},de={class:"flex h-10 w-10 items-center justify-center rounded-xl bg-white text-slate-500 ring-1 ring-slate-200/60"},ue={class:"text-[10px] font-bold uppercase"},ce={class:"flex-1"},pe={class:"text-sm font-semibold text-slate-900"},xe={class:"fixed inset-x-0 bottom-0 bg-white px-5 pb-[calc(1rem+env(safe-area-inset-bottom))] pt-3 shadow-[0_-18px_40px_-32px_rgba(15,23,42,0.45)]"},ve={class:"mx-auto flex w-full max-w-md gap-3"},fe=["disabled"],me=["disabled"],be={key:0,class:"fixed inset-0 z-[90]"},he={class:"absolute inset-x-0 bottom-0 max-h-[70vh] w-full overflow-hidden rounded-t-[24px] bg-white shadow-[0_-4px_20px_rgba(0,0,0,0.25)]"},we={class:"flex items-center justify-between px-5 pb-3 pt-4"},ge={class:"max-h-[calc(70vh-56px)] overflow-y-auto px-3 pb-4"},ye=["onClick"],ke={key:0,class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},Ce=Y({__name:"ExportReportModal",props:{open:{type:Boolean},defaultMonthKey:{}},emits:["close","exported"],setup(D,{emit:U}){const b=D,A=U,O=()=>A("close"),l=p("pdf"),h=p(!0),w=p(!0),g=p(!0),E=o=>`${o.getFullYear()}-${o.getMonth()}`,x=p(E(new Date)),v=p(!1),M=_(()=>{const o=new Date,e=[];for(let s=-120;s<=120;s+=1){const n=new Date(o.getFullYear(),o.getMonth()+s,1),a=new Intl.DateTimeFormat("pt-BR",{month:"long",year:"numeric"}).format(n);e.push({key:`${n.getFullYear()}-${n.getMonth()}`,label:`${a.charAt(0).toUpperCase()+a.slice(1)}`,date:n})}return e}),N=_(()=>M.value.find(o=>o.key===x.value)?.label??""),y=o=>{const e=String(o.getFullYear()),s=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");return`${e}-${s}-${n}`},T=o=>{const[e,s]=String(o).split("-"),n=Number(e),a=Number(s);if(!Number.isFinite(n)||!Number.isFinite(a)){const r=new Date,I=new Date(r.getFullYear(),r.getMonth(),1),S=new Date(r.getFullYear(),r.getMonth()+1,0);return{startISO:y(I),endISO:y(S)}}const F=new Date(n,a,1),k=new Date(n,a+1,0);return{startISO:y(F),endISO:y(k)}},V=_(()=>{const o=(N.value||"Relatorio").replace(/\s+/g,"_"),e=l.value==="excel"?"xlsx":l.value;return`Relatório_${o}.${e}`});H(()=>b.open,o=>{o&&(x.value=b.defaultMonthKey&&M.value.some(e=>e.key===b.defaultMonthKey)?b.defaultMonthKey:E(new Date),l.value="pdf",h.value=!0,w.value=!0,g.value=!0,v.value=!1)});const C=o=>l.value===o?"border-[#14B8A6] bg-[#E6FFFB]":"border-slate-200 bg-white",B=o=>l.value=o,c=p(!1),X=o=>{const s=`; ${document.cookie}`.split(`; ${o}=`);return s.length<2?"":s.pop().split(";").shift()??""},z=()=>{const o=X("XSRF-TOKEN");if(!o)return"";try{return decodeURIComponent(o)}catch{return o}},L=async o=>{if(o==="email"){window.alert("Em breve: envio por email.");return}c.value=!0;try{const{startISO:e,endISO:s}=T(x.value),n=z(),a=await fetch(route("api.relatorios.exportar"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/octet-stream","X-Requested-With":"XMLHttpRequest",...n?{"X-XSRF-TOKEN":n}:{}},body:JSON.stringify({formato:l.value,periodo_inicio:e,periodo_fim:s,incluir_resumo:h.value,incluir_graficos:w.value,incluir_transacoes:g.value})});if(!a.ok)throw new Error("Falha ao exportar relatório");const F=await a.blob(),k=window.URL.createObjectURL(F),r=document.createElement("a"),S=(a.headers.get("content-disposition")??"").match(/filename=\"?([^\";]+)\"?/i);r.href=k,r.download=S?.[1]??V.value,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(k),A("exported",{channel:"download",format:l.value}),O()}catch{window.alert("Não foi possível exportar o relatório.")}finally{c.value=!1}};return(o,e)=>D.open?(u(),d("div",G,[t("header",{class:"flex items-center justify-between px-5 pb-4 pt-[calc(1rem+env(safe-area-inset-top))]"},[e[12]||(e[12]=t("div",{class:"text-xl font-semibold tracking-tight text-slate-900"},"Exportar relatório",-1)),t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-100 text-slate-600","aria-label":"Fechar",onClick:O},[...e[11]||(e[11]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18"}),t("path",{d:"M6 6l12 12"})],-1)])])]),t("main",J,[t("div",W,[t("div",null,[e[14]||(e[14]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Período do relatório",-1)),t("button",{type:"button",class:"mt-3 flex h-12 w-full items-center justify-between rounded-2xl bg-white px-4 shadow-sm ring-1 ring-slate-200/60",onClick:e[0]||(e[0]=s=>v.value=!0)},[t("div",Z,m(N.value),1),e[13]||(e[13]=t("svg",{class:"h-5 w-5 text-slate-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M6 9l6 6 6-6"})],-1))])]),t("div",null,[e[18]||(e[18]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Formato",-1)),t("div",Q,[t("button",{type:"button",class:i(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("pdf")]),onClick:e[1]||(e[1]=s=>B("pdf"))},[e[15]||(e[15]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-red-500 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">PDF</div><div class="mt-1 text-xs font-semibold text-slate-400">Relatório visual com gráficos</div></div></div>',1)),t("span",{class:i(["flex h-5 w-5 items-center justify-center rounded-full border",l.value==="pdf"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[l.value==="pdf"?(u(),d("span",ee)):f("",!0)],2)],2),t("button",{type:"button",class:i(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("excel")]),onClick:e[2]||(e[2]=s=>B("excel"))},[e[16]||(e[16]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-emerald-600 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path><path d="M8 13l4 4"></path><path d="M12 13l-4 4"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">Excel</div><div class="mt-1 text-xs font-semibold text-slate-400">Planilha editável (.xlsx)</div></div></div>',1)),t("span",{class:i(["flex h-5 w-5 items-center justify-center rounded-full border",l.value==="excel"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[l.value==="excel"?(u(),d("span",te)):f("",!0)],2)],2),t("button",{type:"button",class:i(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("csv")]),onClick:e[3]||(e[3]=s=>B("csv"))},[e[17]||(e[17]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path><path d="M8 13h8"></path><path d="M8 17h6"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">CSV</div><div class="mt-1 text-xs font-semibold text-slate-400">Lista simples de transações</div></div></div>',1)),t("span",{class:i(["flex h-5 w-5 items-center justify-center rounded-full border",l.value==="csv"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[l.value==="csv"?(u(),d("span",se)):f("",!0)],2)],2)])]),t("div",null,[e[22]||(e[22]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Incluir no relatório",-1)),t("div",oe,[t("label",le,[$(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[R,h.value]]),e[19]||(e[19]=t("div",{class:"text-sm font-semibold text-slate-700"},"Resumo financeiro",-1))]),t("label",ne,[$(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[R,w.value]]),e[20]||(e[20]=t("div",{class:"text-sm font-semibold text-slate-700"},"Gráficos",-1))]),t("label",ae,[$(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[R,g.value]]),e[21]||(e[21]=t("div",{class:"text-sm font-semibold text-slate-700"},"Lista de transações",-1))])])]),t("div",re,[t("div",ie,[t("div",de,[t("div",ue,m(l.value==="excel"?"XLSX":l.value),1)]),t("div",ce,[t("div",pe,m(V.value),1),e[23]||(e[23]=t("div",{class:"mt-1 text-xs font-semibold text-slate-400"},"~2 MB",-1))])])])])]),t("footer",xe,[t("div",ve,[t("button",{type:"button",class:i(["flex h-[52px] flex-1 items-center justify-center gap-2 rounded-2xl border border-[#14B8A6] bg-white text-sm font-semibold text-[#14B8A6]",c.value?"opacity-60":""]),disabled:c.value,onClick:e[7]||(e[7]=s=>L("email"))},[...e[24]||(e[24]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 6h16v12H4V6Z"}),t("path",{d:"m4 7 8 6 8-6"})],-1),K(" E-mail ",-1)])],10,fe),t("button",{type:"button",class:i(["flex h-[52px] flex-1 items-center justify-center gap-2 rounded-2xl bg-[#14B8A6] text-sm font-semibold text-white shadow-[0_2px_8px_rgba(20,184,166,0.25)]",c.value?"opacity-60":""]),disabled:c.value,onClick:e[8]||(e[8]=s=>L("download"))},[e[25]||(e[25]=t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 3v12"}),t("path",{d:"M8 11l4 4 4-4"}),t("path",{d:"M4 21h16"})],-1)),K(" "+m(c.value?"Gerando…":"Baixar"),1)],10,me)])]),v.value?(u(),d("div",be,[t("button",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",type:"button",onClick:e[9]||(e[9]=s=>v.value=!1),"aria-label":"Fechar"}),t("div",he,[t("div",we,[e[26]||(e[26]=t("div",{class:"text-sm font-bold text-slate-900"},"Escolha o mês",-1)),t("button",{type:"button",class:"text-sm font-semibold text-[#14B8A6]",onClick:e[10]||(e[10]=s=>v.value=!1)},"Fechar")]),t("div",ge,[(u(!0),d(P,null,q(M.value,s=>(u(),d("button",{key:s.key,type:"button",class:i(["flex w-full items-center justify-between rounded-2xl px-4 py-3 text-left text-sm font-semibold",s.key===x.value?"bg-[#E6FFFB] text-[#14B8A6]":"text-slate-700 hover:bg-slate-50"]),onClick:()=>{x.value=s.key,v.value=!1}},[t("span",null,m(s.label),1),s.key===x.value?(u(),d("svg",ke,[...e[27]||(e[27]=[t("path",{d:"M20 6 9 17l-5-5"},null,-1)])])):f("",!0)],10,ye))),128))])])])):f("",!0)])):f("",!0)}});export{Ce as _};
