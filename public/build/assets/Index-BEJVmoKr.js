import{d as R,u as G,h as m,c as H,g as r,a as N,f as A,i as C,b as K,w as L,e,o as l,F as k,r as z,j as $,t as a,A as F,m as B}from"./app-BblmX-k6.js";import{u as Q,_ as W}from"./useIsMobile-DqUvSeEk.js";import{_ as X,r as M}from"./DesktopShell.vue_vue_type_script_setup_true_lang-CbAI3--o.js";import{_ as Y}from"./CreditCardModal.vue_vue_type_script_setup_true_lang-CC6PATu4.js";import{_ as Z}from"./ConfirmationModal.vue_vue_type_script_setup_true_lang-Oyp1I8tv.js";import"./inputGuards-BV9ov3X1.js";import"./InstitutionAvatar.vue_vue_type_script_setup_true_lang-DLJShT1j.js";const ee={key:0,class:"mt-6 space-y-3"},te={class:"flex items-start justify-between"},se={class:"text-sm font-semibold text-white/80"},oe={class:"mt-2 text-lg font-bold text-white"},ie=["onClick"],le={class:"mt-auto pt-8"},ne={class:"text-xs font-semibold text-white/70"},ae={class:"bg-white p-4"},re={class:"flex items-center justify-between text-sm"},de={class:"text-slate-600"},ce={class:"text-slate-600"},ue={class:"mt-3 h-2 overflow-hidden rounded-full bg-slate-200"},me={class:"mt-4 flex gap-2 text-xs text-slate-500"},fe=["title"],xe=["title"],ve={key:1,class:"mt-8 rounded-2xl border border-dashed border-slate-200 bg-slate-50 p-8 text-center"},pe={class:"mx-auto max-w-4xl"},he={key:0,class:"grid gap-4 sm:grid-cols-2"},be={class:"flex items-start justify-between"},_e={class:"text-sm text-slate-600"},ge={class:"mt-2 text-lg font-semibold text-slate-900"},we=["onClick"],ye={class:"mt-4 space-y-2 text-sm"},Ce={class:"flex justify-between"},ke={class:"font-semibold text-slate-900"},$e={class:"flex justify-between"},Be={class:"font-semibold text-slate-900"},Me={class:"mt-4 flex items-center justify-between"},Se={class:"h-2 flex-1 rounded-full bg-slate-200"},De={class:"ml-3 text-xs font-semibold text-slate-600"},Ee={class:"mt-4 flex gap-2 border-t border-slate-200 pt-4"},je=["onClick"],Ne=["onClick"],Ae={key:1,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 p-12 text-center"},Le={key:2,class:"fixed inset-x-5 bottom-20 z-[80] rounded-2xl bg-slate-900 px-4 py-3 shadow-2xl"},ze={class:"text-sm font-semibold text-white"},Re=R({__name:"Index",setup(Fe){const O=G(),I=Q(),v=m(O.props.creditCards||[]),p=m(!1),h=m(!1),i=m(null),S=m(!1),D=m(""),f=o=>{D.value=o,S.value=!0},g=()=>{i.value=null,p.value=!0},w=o=>{i.value=o,p.value=!0},T=o=>{i.value=o,h.value=!0},V=async o=>{try{o.id?(await M(`/api/cartoes/${o.id}`,{method:"PATCH",body:JSON.stringify(o)}),f("✅ Cartão atualizado"),B.reload()):(await M("/api/cartoes",{method:"POST",body:JSON.stringify({...o,icone:"credit-card"})}),f("✅ Cartão adicionado com sucesso!"),B.reload())}catch(s){console.error(s),f("❌ Erro ao salvar cartão")}},P=async()=>{if(i.value)try{await M(`/api/cartoes/${i.value.id}`,{method:"DELETE"}),h.value=!1,i.value=null,f("Cartão excluído"),B.reload()}catch(o){console.error(o),f("❌ Erro ao excluir cartão")}},b=o=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(o),x=o=>o.limite===0?0:Math.min(100,Math.max(0,Math.round(o.limite_usado/o.limite*100))),E=o=>{const s=x(o);return s<50?"#10B981":s<80?"#F59E0B":"#EF4444"},j=H(()=>{const o=n=>String(n??"").trim().toLowerCase(),s=new Map;for(const n of v.value){const d=o(n.nome),_=s.get(d)??[];_.push(n),s.set(d,_)}const t=[];for(const n of s.values()){if(n.length===1){t.push({...n[0],displayName:n[0].nome});continue}const d=[...n].sort((c,y)=>String(c.id).localeCompare(String(y.id))),_=new Set(d.map(c=>String(c.bandeira??"").toLowerCase())).size>1,U=new Set(d.map(c=>c.dia_vencimento??null)).size>1,J=new Set(d.map(c=>c.dia_fechamento??null)).size>1;d.forEach((c,y)=>{const q=_||U||J?c.nome:`${c.nome} (${y+1})`;t.push({...c,displayName:q})})}const u=new Map(v.value.map((n,d)=>[String(n.id),d]));return t.sort((n,d)=>(u.get(String(n.id))??0)-(u.get(String(d.id))??0))});return(o,s)=>(l(),r(k,null,[K(I)?(l(),N(W,{key:0},{default:L(()=>[e("header",{class:"flex items-center justify-between pt-2"},[s[3]||(s[3]=e("h1",{class:"text-xl font-semibold text-slate-900"},"Cartões",-1)),e("button",{onClick:g,class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-[#14B8A6] text-white shadow-lg shadow-teal-500/20 hover:bg-[#0D9488]","aria-label":"Adicionar cartão"},[...s[2]||(s[2]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),v.value.length?(l(),r("div",ee,[(l(!0),r(k,null,z(j.value,t=>(l(),r("div",{key:t.id,class:"overflow-hidden rounded-2xl shadow-sm ring-1 ring-slate-200/60"},[e("div",{class:"aspect-video rounded-2xl bg-gradient-to-br from-white to-slate-50 p-5",style:$({backgroundColor:t.cor,backgroundImage:"none"})},[e("div",te,[e("div",null,[e("div",se,a(t.bandeira.toUpperCase()),1),e("div",oe,a(t.displayName),1)]),e("button",{class:"flex h-8 w-8 items-center justify-center rounded-full bg-white/20 text-white hover:bg-white/30",onClick:F(u=>w(t),["stop"]),"aria-label":"Mais opções"},[...s[4]||(s[4]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},[e("circle",{cx:"12",cy:"5",r:"2"}),e("circle",{cx:"12",cy:"12",r:"2"}),e("circle",{cx:"12",cy:"19",r:"2"})],-1)])],8,ie)]),e("div",le,[e("div",ne,"Limite: "+a(b(t.limite)),1)])],4),e("div",ae,[e("div",re,[e("span",de,"Usado: "+a(x(t))+"%",1),e("span",ce,"Disponível: "+a(b(t.limite-t.limite_usado)),1)]),e("div",ue,[e("div",{class:"h-full transition-all",style:$({width:`${x(t)}%`,backgroundColor:E(t)})},null,4)]),e("div",me,[t.dia_fechamento?(l(),r("span",{key:0,class:"inline-flex items-center rounded-md bg-slate-100 px-2 py-0.5 font-semibold text-slate-600",title:`Fechamento dia ${t.dia_fechamento}`}," F "+a(t.dia_fechamento),9,fe)):C("",!0),t.dia_vencimento?(l(),r("span",{key:1,class:"inline-flex items-center rounded-md bg-slate-100 px-2 py-0.5 font-semibold text-slate-600",title:`Vencimento dia ${t.dia_vencimento}`}," V "+a(t.dia_vencimento),9,xe)):C("",!0)])])]))),128))])):(l(),r("div",ve,[s[5]||(s[5]=e("div",{class:"text-sm font-semibold text-slate-900"},"Nenhum cartão cadastrado",-1)),s[6]||(s[6]=e("div",{class:"mt-1 text-xs text-slate-500"},"Adicione seu primeiro cartão de crédito",-1)),e("button",{onClick:g,class:"mt-4 inline-flex rounded-xl bg-[#14B8A6] px-4 py-2 text-sm font-semibold text-white hover:bg-[#0D9488]"}," Adicionar cartão ")]))]),_:1})):(l(),N(X,{key:1,title:"Cartões de Crédito",subtitle:"Gerencie seus cartões de crédito","show-search":!1,"show-new-action":!1},{default:L(()=>[e("div",pe,[e("header",{class:"flex items-center justify-between py-6"},[s[7]||(s[7]=e("h1",{class:"text-2xl font-bold text-slate-900"},"Cartões de Crédito",-1)),e("button",{onClick:g,class:"rounded-xl bg-[#14B8A6] px-6 py-2 font-semibold text-white shadow-lg shadow-teal-500/20 hover:bg-[#0D9488]"}," + Adicionar Cartão ")]),v.value.length?(l(),r("div",he,[(l(!0),r(k,null,z(j.value,t=>(l(),r("div",{key:t.id,class:"rounded-xl border border-slate-200 p-6"},[e("div",be,[e("div",null,[e("div",_e,a(t.bandeira.toUpperCase()),1),e("div",ge,a(t.displayName),1)]),e("button",{class:"flex h-8 w-8 items-center justify-center rounded-lg text-slate-400 hover:bg-slate-100",onClick:F(u=>w(t),["stop"]),"aria-label":"Editar"},[...s[8]||(s[8]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M12 5v14M5 12h14"})],-1)])],8,we)]),e("div",ye,[e("div",Ce,[s[9]||(s[9]=e("span",{class:"text-slate-600"},"Limite:",-1)),e("span",ke,a(b(t.limite)),1)]),e("div",$e,[s[10]||(s[10]=e("span",{class:"text-slate-600"},"Disponível:",-1)),e("span",Be,a(b(t.limite-t.limite_usado)),1)])]),e("div",Me,[e("div",Se,[e("div",{class:"h-full rounded-full transition-all",style:$({width:`${x(t)}%`,backgroundColor:E(t)})},null,4)]),e("span",De,a(x(t))+"%",1)]),e("div",Ee,[e("button",{onClick:u=>w(t),class:"flex-1 rounded-lg bg-slate-100 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-200"}," Editar ",8,je),e("button",{onClick:u=>T(t),class:"flex-1 rounded-lg bg-red-50 py-2 text-sm font-semibold text-red-600 hover:bg-red-100"}," Excluir ",8,Ne)])]))),128))])):(l(),r("div",Ae,[...s[11]||(s[11]=[e("div",{class:"text-lg font-semibold text-slate-900"},"Nenhum cartão cadastrado",-1),e("div",{class:"mt-2 text-slate-600"},"Adicione seu primeiro cartão de crédito para começar",-1)])]))])]),_:1})),A(Y,{open:p.value,initial:i.value?{id:i.value.id,nome:i.value.nome,bandeira:i.value.bandeira,limite:i.value.limite,dia_fechamento:i.value.dia_fechamento,dia_vencimento:i.value.dia_vencimento,cor:i.value.cor}:null,onClose:s[0]||(s[0]=t=>p.value=!1),onSave:V},null,8,["open","initial"]),A(Z,{open:h.value,title:"Excluir cartão?",message:"Tem certeza que deseja excluir? Esta ação não pode ser desfeita.",danger:!0,onConfirm:P,onClose:s[1]||(s[1]=t=>h.value=!1)},null,8,["open"]),S.value?(l(),r("div",Le,[e("div",ze,a(D.value),1)])):C("",!0)],64))}});export{Re as default};
