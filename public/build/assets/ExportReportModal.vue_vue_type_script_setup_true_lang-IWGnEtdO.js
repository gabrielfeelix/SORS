import{d as T,h as p,c as _,p as Y,g as d,i as m,e as t,t as b,n as r,s as j,x as $,y as A,k as K,F as P,r as H,o as u}from"./app-DvJ-vTb0.js";const X={key:0,class:"fixed inset-0 z-[85] bg-white"},G={class:"mx-auto w-full max-w-md px-5 pb-[calc(7rem+env(safe-area-inset-bottom))]"},q={class:"mt-2 space-y-6"},J={class:"text-sm font-semibold text-slate-900"},Z={class:"mt-3 space-y-3"},Q={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},W={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},ee={key:0,class:"h-2.5 w-2.5 rounded-full bg-white"},te={class:"mt-3 space-y-3"},se={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},le={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},oe={class:"flex items-center gap-3 rounded-2xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},ne={class:"rounded-2xl bg-slate-50 p-4 ring-1 ring-slate-200/60"},ae={class:"flex items-center gap-4"},ie={class:"flex h-10 w-10 items-center justify-center rounded-xl bg-white text-slate-500 ring-1 ring-slate-200/60"},re={class:"text-[10px] font-bold uppercase"},de={class:"flex-1"},ue={class:"text-sm font-semibold text-slate-900"},ce={class:"fixed inset-x-0 bottom-0 bg-white px-5 pb-[calc(1rem+env(safe-area-inset-bottom))] pt-3 shadow-[0_-18px_40px_-32px_rgba(15,23,42,0.45)]"},pe={class:"mx-auto flex w-full max-w-md gap-3"},xe=["disabled"],ve=["disabled"],me={key:0,class:"fixed inset-0 z-[90]"},be={class:"absolute inset-x-0 bottom-0 max-h-[70vh] w-full overflow-hidden rounded-t-[24px] bg-white shadow-[0_-4px_20px_rgba(0,0,0,0.25)]"},fe={class:"flex items-center justify-between px-5 pb-3 pt-4"},he={class:"max-h-[calc(70vh-56px)] overflow-y-auto px-3 pb-4"},we=["onClick"],ge={key:0,class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3"},ke=T({__name:"ExportReportModal",props:{open:{type:Boolean},defaultMonthKey:{}},emits:["close","exported"],setup(D,{emit:U}){const f=D,R=U,O=()=>R("close"),o=p("pdf"),h=p(!0),w=p(!0),g=p(!0),E=l=>`${l.getFullYear()}-${l.getMonth()}`,x=p(E(new Date)),v=p(!1),M=_(()=>{const l=new Date,e=[];for(let s=-120;s<=120;s+=1){const n=new Date(l.getFullYear(),l.getMonth()+s,1),a=new Intl.DateTimeFormat("pt-BR",{month:"long",year:"numeric"}).format(n);e.push({key:`${n.getFullYear()}-${n.getMonth()}`,label:`${a.charAt(0).toUpperCase()+a.slice(1)}`,date:n})}return e}),N=_(()=>M.value.find(l=>l.key===x.value)?.label??""),y=l=>{const e=String(l.getFullYear()),s=String(l.getMonth()+1).padStart(2,"0"),n=String(l.getDate()).padStart(2,"0");return`${e}-${s}-${n}`},z=l=>{const[e,s]=String(l).split("-"),n=Number(e),a=Number(s);if(!Number.isFinite(n)||!Number.isFinite(a)){const i=new Date,I=new Date(i.getFullYear(),i.getMonth(),1),S=new Date(i.getFullYear(),i.getMonth()+1,0);return{startISO:y(I),endISO:y(S)}}const F=new Date(n,a,1),k=new Date(n,a+1,0);return{startISO:y(F),endISO:y(k)}},V=_(()=>{const l=(N.value||"Relatorio").replace(/\s+/g,"_"),e=o.value==="excel"?"xlsx":o.value;return`Relatório_${l}.${e}`});Y(()=>f.open,l=>{l&&(x.value=f.defaultMonthKey&&M.value.some(e=>e.key===f.defaultMonthKey)?f.defaultMonthKey:E(new Date),o.value="pdf",h.value=!0,w.value=!0,g.value=!0,v.value=!1)});const C=l=>o.value===l?"border-[#14B8A6] bg-[#E6FFFB]":"border-slate-200 bg-white",B=l=>o.value=l,c=p(!1),L=async l=>{if(l==="email"){window.alert("Em breve: envio por email.");return}c.value=!0;try{const{startISO:e,endISO:s}=z(x.value),n=document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??"",a=await fetch(route("api.relatorios.exportar"),{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/octet-stream",...n?{"X-CSRF-TOKEN":n}:{}},body:JSON.stringify({formato:o.value,periodo_inicio:e,periodo_fim:s,incluir_resumo:h.value,incluir_graficos:w.value,incluir_transacoes:g.value})});if(!a.ok)throw new Error("Falha ao exportar relatório");const F=await a.blob(),k=window.URL.createObjectURL(F),i=document.createElement("a"),S=(a.headers.get("content-disposition")??"").match(/filename=\"?([^\";]+)\"?/i);i.href=k,i.download=S?.[1]??V.value,document.body.appendChild(i),i.click(),i.remove(),window.URL.revokeObjectURL(k),R("exported",{channel:"download",format:o.value}),O()}catch{window.alert("Não foi possível exportar o relatório.")}finally{c.value=!1}};return(l,e)=>D.open?(u(),d("div",X,[t("header",{class:"flex items-center justify-between px-5 pb-4 pt-[calc(1rem+env(safe-area-inset-top))]"},[e[12]||(e[12]=t("div",{class:"text-xl font-semibold tracking-tight text-slate-900"},"Exportar relatório",-1)),t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-100 text-slate-600","aria-label":"Fechar",onClick:O},[...e[11]||(e[11]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M18 6L6 18"}),t("path",{d:"M6 6l12 12"})],-1)])])]),t("main",G,[t("div",q,[t("div",null,[e[14]||(e[14]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Período do relatório",-1)),t("button",{type:"button",class:"mt-3 flex h-12 w-full items-center justify-between rounded-2xl bg-white px-4 shadow-sm ring-1 ring-slate-200/60",onClick:e[0]||(e[0]=s=>v.value=!0)},[t("div",J,b(N.value),1),e[13]||(e[13]=t("svg",{class:"h-5 w-5 text-slate-300",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M6 9l6 6 6-6"})],-1))])]),t("div",null,[e[18]||(e[18]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Formato",-1)),t("div",Z,[t("button",{type:"button",class:r(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("pdf")]),onClick:e[1]||(e[1]=s=>B("pdf"))},[e[15]||(e[15]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-red-500 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">PDF</div><div class="mt-1 text-xs font-semibold text-slate-400">Relatório visual com gráficos</div></div></div>',1)),t("span",{class:r(["flex h-5 w-5 items-center justify-center rounded-full border",o.value==="pdf"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[o.value==="pdf"?(u(),d("span",Q)):m("",!0)],2)],2),t("button",{type:"button",class:r(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("excel")]),onClick:e[2]||(e[2]=s=>B("excel"))},[e[16]||(e[16]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-emerald-600 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path><path d="M8 13l4 4"></path><path d="M12 13l-4 4"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">Excel</div><div class="mt-1 text-xs font-semibold text-slate-400">Planilha editável (.xlsx)</div></div></div>',1)),t("span",{class:r(["flex h-5 w-5 items-center justify-center rounded-full border",o.value==="excel"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[o.value==="excel"?(u(),d("span",W)):m("",!0)],2)],2),t("button",{type:"button",class:r(["flex w-full items-center justify-between rounded-2xl border p-4 text-left",C("csv")]),onClick:e[3]||(e[3]=s=>B("csv"))},[e[17]||(e[17]=j('<div class="flex items-center gap-4"><span class="flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60"><svg class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><path d="M14 2v6h6"></path><path d="M8 13h8"></path><path d="M8 17h6"></path></svg></span><div><div class="text-sm font-semibold text-slate-900">CSV</div><div class="mt-1 text-xs font-semibold text-slate-400">Lista simples de transações</div></div></div>',1)),t("span",{class:r(["flex h-5 w-5 items-center justify-center rounded-full border",o.value==="csv"?"border-[#14B8A6] bg-[#14B8A6]":"border-slate-200 bg-white"])},[o.value==="csv"?(u(),d("span",ee)):m("",!0)],2)],2)])]),t("div",null,[e[22]||(e[22]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Incluir no relatório",-1)),t("div",te,[t("label",se,[$(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>h.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[A,h.value]]),e[19]||(e[19]=t("div",{class:"text-sm font-semibold text-slate-700"},"Resumo financeiro",-1))]),t("label",le,[$(t("input",{"onUpdate:modelValue":e[5]||(e[5]=s=>w.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[A,w.value]]),e[20]||(e[20]=t("div",{class:"text-sm font-semibold text-slate-700"},"Gráficos",-1))]),t("label",oe,[$(t("input",{"onUpdate:modelValue":e[6]||(e[6]=s=>g.value=s),type:"checkbox",class:"h-5 w-5 rounded-md border-slate-300 text-blue-600"},null,512),[[A,g.value]]),e[21]||(e[21]=t("div",{class:"text-sm font-semibold text-slate-700"},"Lista de transações",-1))])])]),t("div",ne,[t("div",ae,[t("div",ie,[t("div",re,b(o.value==="excel"?"XLSX":o.value),1)]),t("div",de,[t("div",ue,b(V.value),1),e[23]||(e[23]=t("div",{class:"mt-1 text-xs font-semibold text-slate-400"},"~2 MB",-1))])])])])]),t("footer",ce,[t("div",pe,[t("button",{type:"button",class:r(["flex h-[52px] flex-1 items-center justify-center gap-2 rounded-2xl border border-[#14B8A6] bg-white text-sm font-semibold text-[#14B8A6]",c.value?"opacity-60":""]),disabled:c.value,onClick:e[7]||(e[7]=s=>L("email"))},[...e[24]||(e[24]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 6h16v12H4V6Z"}),t("path",{d:"m4 7 8 6 8-6"})],-1),K(" Email ",-1)])],10,xe),t("button",{type:"button",class:r(["flex h-[52px] flex-1 items-center justify-center gap-2 rounded-2xl bg-[#14B8A6] text-sm font-semibold text-white shadow-[0_2px_8px_rgba(20,184,166,0.25)]",c.value?"opacity-60":""]),disabled:c.value,onClick:e[8]||(e[8]=s=>L("download"))},[e[25]||(e[25]=t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 3v12"}),t("path",{d:"M8 11l4 4 4-4"}),t("path",{d:"M4 21h16"})],-1)),K(" "+b(c.value?"Gerando…":"Baixar"),1)],10,ve)])]),v.value?(u(),d("div",me,[t("button",{class:"absolute inset-0 bg-black/50 backdrop-blur-sm",type:"button",onClick:e[9]||(e[9]=s=>v.value=!1),"aria-label":"Fechar"}),t("div",be,[t("div",fe,[e[26]||(e[26]=t("div",{class:"text-sm font-bold text-slate-900"},"Escolha o mês",-1)),t("button",{type:"button",class:"text-sm font-semibold text-[#14B8A6]",onClick:e[10]||(e[10]=s=>v.value=!1)},"Fechar")]),t("div",he,[(u(!0),d(P,null,H(M.value,s=>(u(),d("button",{key:s.key,type:"button",class:r(["flex w-full items-center justify-between rounded-2xl px-4 py-3 text-left text-sm font-semibold",s.key===x.value?"bg-[#E6FFFB] text-[#14B8A6]":"text-slate-700 hover:bg-slate-50"]),onClick:()=>{x.value=s.key,v.value=!1}},[t("span",null,b(s.label),1),s.key===x.value?(u(),d("svg",ge,[...e[27]||(e[27]=[t("path",{d:"M20 6 9 17l-5-5"},null,-1)])])):m("",!0)],10,we))),128))])])])):m("",!0)])):m("",!0)}});export{ke as _};
