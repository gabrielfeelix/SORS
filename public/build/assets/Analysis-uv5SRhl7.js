import{d as ue,u as ve,c as n,h as v,a as me,w as Y,e as t,f as b,g as r,i as fe,b as O,o as l,l as xe,t as d,F as k,r as _,j as E,n as J,k as K,B as he,C as pe,m as ge}from"./app-DvJ-vTb0.js";import{_ as be,a as we,r as ye}from"./DesktopShell.vue_vue_type_script_setup_true_lang-BVoVaQ94.js";import{_ as ke,T as _e,e as Me,h as q,b as Ce,a as Be}from"./TransactionModal-CAPdfSRY.js";import{u as De,_ as Fe}from"./useIsMobile-CMH_TBsk.js";import{_ as $e}from"./ExportReportModal.vue_vue_type_script_setup_true_lang-IWGnEtdO.js";import{_ as Te}from"./MobileToast.vue_vue_type_script_setup_true_lang-C8uRLjf5.js";import"./inputGuards-BTKUKM9N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const je={class:"flex items-center justify-between pt-2"},Ee={key:0},Se={class:"mt-5 rounded-2xl bg-white px-3 py-3 shadow-sm ring-1 ring-slate-200/60"},Ae={class:"flex items-center justify-between"},Ne={class:"text-sm font-semibold tracking-wide text-slate-900"},Le={class:"mt-4 overflow-hidden rounded-3xl bg-white shadow-sm ring-1 ring-slate-200/60"},Pe={class:"grid grid-cols-3 divide-x divide-slate-100"},Re={class:"px-4 py-4 text-center"},Ve={class:"mt-2 text-sm font-semibold text-emerald-600"},ze={class:"px-4 py-4 text-center"},Ie={class:"mt-2 text-sm font-semibold text-red-500"},Ye={class:"px-4 py-4 text-center"},Oe={class:"mt-2 text-sm font-semibold text-emerald-600"},Je={class:"mt-4 rounded-3xl bg-white p-5 shadow-sm ring-1 ring-slate-200/60"},Ke={key:0},qe={class:"mt-6 flex items-center justify-center"},Qe={class:"relative h-52 w-52"},Ue={class:"h-full w-full -rotate-90",viewBox:"0 0 160 160"},We=["r","stroke","stroke-dasharray","stroke-dashoffset"],Ge={class:"absolute inset-0 flex flex-col items-center justify-center text-center"},He={class:"text-3xl font-semibold text-slate-900"},Xe={class:"mt-5 space-y-3"},Ze={class:"flex-1 text-sm font-semibold text-slate-600"},et={class:"text-sm font-semibold text-slate-900"},tt={class:"w-12 text-right text-xs font-semibold text-slate-400"},st={key:1,class:"mt-6 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},at={class:"mt-4 rounded-3xl bg-white p-5 shadow-sm ring-1 ring-slate-200/60"},ot={key:0},nt={class:"mt-5 grid grid-cols-3 items-end gap-4"},lt={class:"text-xs font-semibold text-slate-400"},rt={class:"mt-4 text-sm font-semibold text-slate-400"},it={class:"text-red-500"},dt={key:1,class:"mt-5 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},ct={class:"mt-5 pb-4"},ut={key:0,class:"mt-4 space-y-4"},vt={class:"flex items-center justify-between text-sm font-semibold"},mt={class:"flex min-w-0 items-center gap-2 text-slate-900"},ft={class:"flex h-7 w-7 shrink-0 items-center justify-center rounded-full bg-slate-100 text-slate-600"},xt={class:"truncate"},ht={class:"text-slate-900"},pt={class:"mt-2 h-2 w-full rounded-full bg-slate-100"},gt={key:1,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-6 text-center"},Ft=ue({__name:"Analysis",setup(bt){const Q=ve(),f=n(()=>Q.props.bootstrap??{entries:[],goals:[],accounts:[],categories:[],tags:[]}),w=n(()=>f.value.entries??[]),U=n(()=>{const a=new Map;for(const e of f.value.categories??[]){const s=e.type==="income"?"income":e.type==="expense"?"expense":void 0,o=a.get(e.name),i=o?.kind&&s&&o.kind!==s?void 0:o?.kind??s;a.set(e.name,{key:e.name,label:e.name,icon:"other",tone:"slate",kind:i})}return Array.from(a.values())}),W=n(()=>{const a=s=>{const o=s.toLowerCase();return o.includes("nubank")?"purple":o.includes("inter")?"amber":o.includes("carteira")||o.includes("dinheiro")?"emerald":"slate"},e=[];for(const s of f.value.accounts??[])s.type!=="credit_card"&&e.push({key:s.name,label:s.name,subtitle:s.type==="wallet"?"Carteira":"Conta",tone:a(s.name),type:s.type,balance:Number(s.current_balance??0),customColor:s.color??void 0,icon:s.icon??void 0});for(const s of f.value.accounts??[]){if(s.type!=="credit_card")continue;const o=Number(s.credit_limit??0),i=Math.max(0,Number(s.current_balance??0));e.push({key:s.name,label:s.name,subtitle:"Cartão de Crédito",tone:a(s.name),type:"credit_card",limit:o,used:i,available:o-i,customColor:s.color??void 0,icon:s.icon??void 0})}return e}),M=a=>`${a.getFullYear()}-${a.getMonth()}`,S=a=>`${a.getFullYear()}`,c=v(new Date),A=v("month"),N=n(()=>`${new Intl.DateTimeFormat("pt-BR",{month:"long"}).format(c.value).toUpperCase()} ${c.value.getFullYear()}`),C=De(),G=n(()=>C.value?Fe:be),H=n(()=>C.value?{showNav:!0}:{title:"Relatórios",subtitle:N.value,searchPlaceholder:"Buscar transação…",newActionLabel:"Nova Transação",showSearch:!1}),L=a=>{const e=new Date(c.value);e.setMonth(e.getMonth()+a),c.value=e},x=n(()=>{if(!w.value.length)return[];if(A.value==="month"){const a=M(c.value);return w.value.filter(e=>{if(!e.transactionDate)return!1;const s=new Date(e.transactionDate);return M(s)===a})}if(A.value==="year"){const a=S(c.value);return w.value.filter(e=>{if(!e.transactionDate)return!1;const s=new Date(e.transactionDate);return S(s)===a})}return w.value.filter(a=>{if(!a.transactionDate)return!1;const e=new Date(a.transactionDate),s=(c.value.getFullYear()-e.getFullYear())*12+(c.value.getMonth()-e.getMonth());return s>=0&&s<3})}),m=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",maximumFractionDigits:0}).format(a),P=n(()=>x.value.filter(a=>a.kind==="income").reduce((a,e)=>a+e.amount,0)),B=n(()=>x.value.filter(a=>a.kind==="expense").reduce((a,e)=>a+e.amount,0)),X=n(()=>P.value-B.value),R=a=>String(a??"").trim().toLowerCase(),Z=n(()=>{const a=new Map;for(const e of f.value.categories??[])a.set(`${R(e.name)}|${e.type}`,e.icon??"other");return a}),ee=a=>{const e=String(a.categoryKey??"").toLowerCase();return e==="food"?"food":e==="home"?"home":e==="car"?"car":"other"},D=n(()=>{const a=["#14B8A6","#3B82F6","#F59E0B","#10B981","#EF4444","#8B5CF6"],e=new Map;for(const s of x.value){if(s.kind!=="expense")continue;const o=s.categoryLabel||"Outros";e.set(o,(e.get(o)??0)+s.amount)}return Array.from(e.entries()).map(([s,o],i)=>({key:s.toLowerCase().replace(/\s+/g,"-"),label:s,value:o,color:a[i%a.length]}))}),h=n(()=>D.value.reduce((a,e)=>a+e.value,0)),V=n(()=>D.value.map(a=>({...a,pct:h.value?Math.round(a.value/h.value*100):0}))),te=n(()=>{const e=2*Math.PI*64;let s=0;return V.value.map(o=>{const i=h.value?o.value/h.value:0,u=e*i,g={...o,radius:64,circumference:e,dasharray:`${u} ${e-u}`,dashoffset:-s};return s+=u,g})}),p=n(()=>{const a=new Date(c.value),e=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],s=Array.from({length:3},(o,i)=>{const u=new Date(a.getFullYear(),a.getMonth()-(2-i),1);return{key:`${u.getFullYear()}-${u.getMonth()+1}`,label:e[u.getMonth()],value:0,highlight:i===2}});for(const o of x.value){if(!o.transactionDate)continue;const i=new Date(o.transactionDate),u=`${i.getFullYear()}-${i.getMonth()+1}`,g=s.find(ce=>ce.key===u);g&&(g.value+=o.kind==="expense"?o.amount:0)}return s}),se=n(()=>Math.max(...p.value.map(a=>a.value),1)),ae=n(()=>{const a=p.value.at(-1)?.value??0,e=p.value.at(-2)?.value??0;return e?Math.round((a-e)/e*1e3)/10:0}),F=n(()=>{const a=["#3B82F6","#F59E0B","#EF4444","#8B5CF6","#10B981"];return x.value.filter(e=>e.kind==="expense").sort((e,s)=>s.amount-e.amount).slice(0,5).map((e,s)=>({key:e.id,label:e.title,categoryIcon:Z.value.get(`${R(e.categoryLabel)}|expense`)??ee(e),value:e.amount,color:a[s%a.length]}))}),oe=n(()=>Math.max(...F.value.map(a=>a.value),1)),ne=n(()=>D.value.length>0&&h.value>0),le=n(()=>p.value.length>0),re=n(()=>F.value.length>0),$=v(!1),z=v("expense");v(!1);const T=v(!1);v(!1);const j=v(!1),I=v(""),y=a=>{I.value=a,j.value=!0},ie=()=>{z.value="expense",$.value=!0},de=async a=>{if(a.kind==="transfer"){try{await Me(a),y("Transferência realizada"),ge.reload({only:["bootstrap"]})}catch{y("Não foi possível realizar a transferência")}return}await(q(a)?we:ye)(route("transactions.store"),{method:"POST",body:q(a)?Ce(a):JSON.stringify(Be(a))}),y("Movimentação salva")};return(a,e)=>(l(),me(pe(G.value),he(H.value,{onAdd:ie}),{default:Y(()=>[t("header",je,[O(C)?(l(),r("div",Ee,[...e[7]||(e[7]=[t("div",{class:"text-2xl font-semibold tracking-tight text-slate-900"},"Relatórios",-1)])])):fe("",!0),t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-500 shadow-sm ring-1 ring-slate-200/60","aria-label":"Exportar relatório",onClick:e[0]||(e[0]=s=>T.value=!0)},[...e[8]||(e[8]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v10"}),t("path",{d:"M8 9l4-4 4 4"}),t("path",{d:"M4 19h16"})],-1)])])]),b(O(xe),{href:a.route("analysis.compare"),class:"mt-6 flex items-center justify-between gap-4 rounded-2xl bg-[#E6FFFB] px-4 py-4 shadow-sm ring-1 ring-emerald-100"},{default:Y(()=>[...e[9]||(e[9]=[t("div",{class:"flex items-center gap-4"},[t("span",{class:"flex h-12 w-12 items-center justify-center rounded-2xl bg-[#14B8A6] text-white"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M7 7h10"}),t("path",{d:"M7 17h10"}),t("path",{d:"M10 10l-3-3 3-3"}),t("path",{d:"M14 14l3 3-3 3"})])]),t("div",null,[t("div",{class:"text-sm font-semibold text-slate-900"},"Comparar Períodos"),t("div",{class:"mt-1 text-xs font-semibold text-slate-500"},"Jan 2026 vs Dez 2025")])],-1),t("svg",{class:"h-5 w-5 text-emerald-600",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1)])]),_:1},8,["href"]),t("div",Se,[t("div",Ae,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-xl text-slate-500 hover:bg-slate-50","aria-label":"Mês anterior",onClick:e[1]||(e[1]=s=>L(-1))},[...e[10]||(e[10]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),t("div",Ne,d(N.value),1),t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-xl text-slate-500 hover:bg-slate-50","aria-label":"Próximo mês",onClick:e[2]||(e[2]=s=>L(1))},[...e[11]||(e[11]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1)])])])]),t("div",Le,[t("div",Pe,[t("div",Re,[e[12]||(e[12]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Receitas",-1)),t("div",Ve,d(m(P.value)),1)]),t("div",ze,[e[13]||(e[13]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Despesas",-1)),t("div",Ie,d(m(B.value)),1)]),t("div",Ye,[e[14]||(e[14]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Balanço",-1)),t("div",Oe,"+"+d(m(X.value)),1)])])]),t("div",Je,[e[18]||(e[18]=t("div",{class:"text-base font-semibold text-slate-900"},"Despesas por categoria",-1)),ne.value?(l(),r("div",Ke,[t("div",qe,[t("div",Qe,[(l(),r("svg",Ue,[e[15]||(e[15]=t("circle",{cx:"80",cy:"80",r:"64",stroke:"#E2E8F0","stroke-width":"18",fill:"none"},null,-1)),(l(!0),r(k,null,_(te.value,s=>(l(),r("circle",{key:s.key,cx:"80",cy:"80",r:s.radius,stroke:s.color,"stroke-width":"18",fill:"none","stroke-linecap":"butt","stroke-dasharray":s.dasharray,"stroke-dashoffset":s.dashoffset},null,8,We))),128))])),t("div",Ge,[t("div",He,d(m(B.value)),1),e[16]||(e[16]=t("div",{class:"mt-1 text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Total de despesas",-1))])])]),t("div",Xe,[(l(!0),r(k,null,_(V.value,s=>(l(),r("div",{key:s.key,class:"flex items-center gap-3"},[t("span",{class:"h-3 w-3 rounded-full",style:E({backgroundColor:s.color})},null,4),t("div",Ze,d(s.label),1),t("div",et,d(m(s.value)),1),t("div",tt,"("+d(s.pct)+"%)",1)]))),128))])])):(l(),r("div",st,[...e[17]||(e[17]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 8v8"}),t("path",{d:"M8 12h8"}),t("circle",{cx:"12",cy:"12",r:"9"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Você ainda não possui despesas este mês.",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Adicione seus gastos para ver o gráfico.",-1)])]))]),t("div",at,[e[22]||(e[22]=t("div",{class:"text-base font-semibold text-slate-900"},"Últimos 3 meses",-1)),le.value?(l(),r("div",ot,[t("div",nt,[(l(!0),r(k,null,_(p.value,s=>(l(),r("div",{key:s.key,class:"text-center"},[t("div",lt,d(m(s.value)),1),t("div",{class:J(["mx-auto mt-3 w-20 rounded-2xl",s.highlight?"bg-teal-500":"bg-slate-200"]),style:E({height:`${Math.max(28,Math.round(s.value/se.value*96))}px`})},null,6),t("div",{class:J(["mt-2 text-xs font-semibold",s.highlight?"text-teal-600":"text-slate-400"])},d(s.label),3)]))),128))]),t("div",rt,[e[19]||(e[19]=K(" Aumento de ",-1)),t("span",it,d(ae.value)+"%",1),e[20]||(e[20]=K(" em relação ao mês anterior ",-1))])])):(l(),r("div",dt,[...e[21]||(e[21]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 19V5"}),t("path",{d:"M10 19V9"}),t("path",{d:"M16 19v-4"}),t("path",{d:"M22 19V7"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Sem histórico ainda",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Seu gráfico aparece quando houver lançamentos.",-1)])]))]),t("div",ct,[e[24]||(e[24]=t("div",{class:"text-lg font-semibold text-slate-900"},"Top 5 gastos",-1)),re.value?(l(),r("div",ut,[(l(!0),r(k,null,_(F.value,s=>(l(),r("div",{key:s.key},[t("div",vt,[t("div",mt,[t("span",ft,[b(ke,{icon:s.categoryIcon,class:"h-4 w-4"},null,8,["icon"])]),t("span",xt,d(s.label),1)]),t("div",ht,d(m(s.value)),1)]),t("div",pt,[t("div",{class:"h-2 rounded-full",style:E({width:`${Math.round(s.value/oe.value*100)}%`,backgroundColor:s.color})},null,4)])]))),128))])):(l(),r("div",gt,[...e[23]||(e[23]=[t("div",{class:"mx-auto flex h-12 w-12 items-center justify-center rounded-2xl bg-white text-slate-400"},[t("svg",{class:"h-6 w-6",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("rect",{x:"3",y:"5",width:"18",height:"14",rx:"3"}),t("path",{d:"M3 10h18"})])],-1),t("div",{class:"mt-3 text-sm font-semibold text-slate-900"},"Sem gastos registrados",-1),t("div",{class:"mt-1 text-xs text-slate-500"},"Adicione lançamentos para preencher este ranking.",-1)])]))]),b(_e,{open:$.value,kind:z.value,categories:U.value,accounts:W.value,tags:f.value.tags,onClose:e[3]||(e[3]=s=>$.value=!1),onSave:de},null,8,["open","kind","categories","accounts","tags"]),b($e,{open:T.value,"default-month-key":M(c.value),onClose:e[4]||(e[4]=s=>T.value=!1),onExported:e[5]||(e[5]=({channel:s})=>{y(s==="download"?"Relatório baixado":"Relatório enviado por email")})},null,8,["open","default-month-key"]),b(Te,{show:j.value,message:I.value,onDismiss:e[6]||(e[6]=s=>j.value=!1)},null,8,["show","message"])]),_:1},16))}});export{Ft as default};
