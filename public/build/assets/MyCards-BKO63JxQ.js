import{d as J,c as u,h as C,z as Q,p as I,g as d,f as _,a as U,b as m,D as W,E as X,w as D,e,i as M,o,l as R,n as x,t as c,j,F as P,r as z,k as L,G as ee,H as te,C as se}from"./app-CbuCxuU_.js";import{u as ae,_ as ne}from"./useIsMobile-eLMgQx8O.js";import{_ as le,r as ie}from"./DesktopShell.vue_vue_type_script_setup_true_lang-B_oLxcMm.js";import{_ as oe}from"./CreateCreditCardFlowModal.vue_vue_type_script_setup_true_lang-DhZGaCgJ.js";import{_ as re}from"./MonthNavigator.vue_vue_type_script_setup_true_lang-BI3xRVJY.js";import{g as de,_ as ce}from"./InstitutionAvatar.vue_vue_type_script_setup_true_lang-COrG5pUr.js";import"./inputGuards-BV9ov3X1.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ue={key:0,class:"flex items-center justify-between px-6 pt-4 pb-8"},me={class:"rounded-3xl bg-[#1E293B] p-6 shadow-xl"},pe={key:0,class:"mt-3 h-10 w-48 animate-pulse rounded-lg bg-white/10"},ve={key:1,class:"mt-3 text-[32px] font-bold leading-none text-white"},he={key:2,class:"mt-6 grid grid-cols-2 gap-6"},fe={key:3,class:"mt-6 grid grid-cols-2 gap-6"},xe={class:"mt-1 flex items-center gap-2"},ge={class:"text-xl font-bold text-[#14B8A6] whitespace-nowrap"},we={class:"h-1.5 flex-1 overflow-hidden rounded-full bg-[#334155]"},be={class:"mt-1 text-xl font-bold text-white"},ye={class:"flex items-center justify-between"},_e={class:"text-xs font-semibold uppercase tracking-wide text-slate-400"},ke={class:"p-4"},Ce={class:"flex items-start gap-3"},De={class:"flex-1 min-w-0"},Me={class:"text-base font-bold text-slate-900"},Se={class:"mt-1 flex flex-wrap items-center gap-1 text-[11px] font-semibold text-slate-500"},Be={key:0,class:"inline-flex items-center rounded-md bg-slate-100 px-2 py-0.5 uppercase tracking-wide text-slate-500"},Ae={class:"text-right"},$e={class:"text-base font-bold text-slate-900"},Ne={class:"mt-3 space-y-2"},Fe={class:"flex items-center justify-between text-[11px] font-medium text-slate-500"},je={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100"},Pe={class:"mt-3 flex items-center justify-between text-[11px] font-semibold text-slate-500"},Ve={class:"flex flex-wrap items-center gap-4"},Ee=["title"],Ie=["title"],Ue={key:2,class:"mt-4 rounded-2xl border border-dashed border-slate-200 bg-slate-50 px-4 py-8 text-center"},qe=J({__name:"MyCards",setup(Re){const p=ae(),T=u(()=>p.value?ne:le),K=u(()=>p.value?{showNav:!1}:{title:"Meus Cartões",subtitle:"Cartões de crédito",showSearch:!1,showNewAction:!1}),k=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2}).format(a),G=a=>a.toLocaleString("pt-BR",{minimumFractionDigits:1,maximumFractionDigits:1})+"%",S=u(()=>{const a=new Date,t=[];for(let s=-2;s<=2;s+=1){const n=new Date(a.getFullYear(),a.getMonth()+s,1),l=new Intl.DateTimeFormat("pt-BR",{month:"short"}).format(n).replace(".","").toUpperCase();t.push({key:`${n.getFullYear()}-${n.getMonth()}`,label:l,date:n})}return t}),v=C(""),g=C(new Map),w=C(new Set);Q(()=>{v.value=S.value[2]?.key??S.value[0]?.key??""}),I(v,a=>{a&&V(a)},{immediate:!0});const V=async a=>{const t=`cards-${a}`;if(g.value.delete(t),!w.value.has(t)){w.value.add(t);try{const[s,n]=a.split("-").map(Number),l=await ie(`/api/cartoes-by-month?year=${s}&month=${n}`,{method:"GET"});g.value.set(t,Array.isArray(l?.cartoes)?l.cartoes:[])}catch(s){console.error("Failed to load credit cards for month",s),g.value.set(t,[])}finally{w.value.delete(t)}}},B=u(()=>{const a=v.value;if(!a)return!1;const t=`cards-${a}`;return w.value.has(t)}),h=u(()=>{const a=v.value;if(!a)return[];const t=`cards-${a}`;if(w.value.has(t))return[];const s=g.value.get(t)??[];return g.value.has(t)?s.map(n=>{const l=Number(n.credit_limit??n.limite??0),i=Math.max(0,Number(n.current_balance??n.limite_usado??0)),f=l>0?i/l*100:0,N=l-i;let y="PAGA";i>=l?y="ATRASADA":i>0&&(y="ABERTA");const r=n.banco??n.institution??n.name??n.nome??null;return{id:n.id,nome:n.name||n.nome,bandeira:n.bandeira??n.card_brand??null,fechamentoDia:Number(n.dia_fechamento??n.closing_day??0)||null,vencimentoDia:Number(n.dia_vencimento??n.due_day??0)||null,cor:(n.color||n.cor)??"#8B5CF6",banco:r,svgPath:n.svgPath??(r?de(r):null),limite:l,usado:i,disponivel:Math.max(0,N),percentualUsado:f,status:y}}):[]}),H=u(()=>{const a=l=>String(l??"").trim().toLowerCase(),t=new Map;for(const l of h.value){const i=a(l.nome),f=t.get(i)??[];f.push(l),t.set(i,f)}const s=[];for(const l of t.values()){if(l.length===1){s.push({...l[0],displayName:l[0].nome});continue}const i=[...l].sort((r,F)=>String(r.id).localeCompare(String(F.id))),f=new Set(i.map(r=>String(r.bandeira??"").toLowerCase())).size>1,N=new Set(i.map(r=>r.vencimentoDia??null)).size>1,y=new Set(i.map(r=>r.fechamentoDia??null)).size>1;i.forEach((r,F)=>{const q=f||N||y?r.nome:`${r.nome} (${F+1})`;s.push({...r,displayName:q})})}const n=new Map(h.value.map((l,i)=>[String(l.id),i]));return s.sort((l,i)=>(n.get(String(l.id))??0)-(n.get(String(i.id))??0))});I(()=>v.value,a=>{a&&V(a)});const A=u(()=>h.value.reduce((a,t)=>a+t.usado,0)),$=u(()=>h.value.reduce((a,t)=>a+t.limite,0)),E=u(()=>$.value===0?0:A.value/$.value*100),O=u(()=>Math.max(0,$.value-A.value)),Y=a=>a==="PAGA"?"bg-emerald-50 text-emerald-600":a==="ATRASADA"?"bg-red-50 text-red-500":"bg-amber-50 text-amber-600",b=C(!1),Z=()=>{b.value=!1,window.location.reload()};return(a,t)=>(o(),d(P,null,[_(m(W),{title:"Meus Cartões"}),(o(),U(se(T.value),ee(te(K.value)),X({default:D(()=>[m(p)?(o(),d("header",ue,[_(m(R),{href:a.route("dashboard"),class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Voltar"},{default:D(()=>[...t[5]||(t[5]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M15 18l-6-6 6-6"})],-1)])]),_:1},8,["href"]),t[7]||(t[7]=e("div",{class:"text-center"},[e("div",{class:"text-lg font-semibold text-slate-900"},"Meus Cartões")],-1)),e("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Adicionar cartão",onClick:t[1]||(t[1]=s=>b.value=!0)},[...t[6]||(t[6]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])])):M("",!0),e("div",{class:x(m(p)?"px-6 pb-6":"pb-6")},[_(re,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=s=>v.value=s),months:S.value},null,8,["modelValue","months"])],2),e("div",{class:x(m(p)?"px-6":"")},[e("div",me,[t[11]||(t[11]=e("div",{class:"flex items-start justify-between"},[e("div",{class:"text-[10px] font-semibold uppercase tracking-wider text-[#64748B]"}," Dívida Consolidada "),e("div",{class:"flex h-6 w-6 items-center justify-center"},[e("svg",{class:"h-4 w-4 text-white/30",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"3",y1:"6",x2:"21",y2:"6"}),e("line",{x1:"3",y1:"12",x2:"21",y2:"12"}),e("line",{x1:"3",y1:"18",x2:"21",y2:"18"})])])],-1)),B.value?(o(),d("div",pe)):(o(),d("div",ve,c(k(A.value)),1)),B.value?(o(),d("div",he,[...t[8]||(t[8]=[e("div",null,[e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Uso de Crédito "),e("div",{class:"mt-1 flex items-center gap-2"},[e("div",{class:"h-7 w-16 animate-pulse rounded bg-white/10"}),e("div",{class:"h-1.5 flex-1 animate-pulse rounded-full bg-[#334155]"})])],-1),e("div",null,[e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Disp. Consolidado "),e("div",{class:"mt-1 h-7 w-32 animate-pulse rounded bg-white/10"})],-1)])])):(o(),d("div",fe,[e("div",null,[t[9]||(t[9]=e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Uso de Crédito ",-1)),e("div",xe,[e("div",ge,c(G(E.value)),1),e("div",we,[e("div",{class:"h-full bg-[#14B8A6] transition-all",style:j({width:`${Math.min(100,E.value)}%`})},null,4)])])]),e("div",null,[t[10]||(t[10]=e("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-[#64748B]"}," Disp. Consolidado ",-1)),e("div",be,c(k(O.value)),1)])]))])],2),e("div",{class:x(m(p)?"mt-8 px-6":"mt-10")},[e("div",ye,[t[12]||(t[12]=e("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-900"}," Cartões ",-1)),e("div",_e,c(h.value.length)+" UNIDADES ",1)]),B.value?(o(),d("div",{key:0,class:x(m(p)?"mt-4 space-y-3 pb-8":"mt-5 grid grid-cols-2 gap-4 pb-10 xl:grid-cols-3")},[(o(),d(P,null,z(3,s=>e("div",{key:s,class:"overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200/60"},[...t[13]||(t[13]=[e("div",{class:"p-4"},[e("div",{class:"flex items-start gap-3"},[e("div",{class:"h-12 w-12 shrink-0 animate-pulse rounded-2xl bg-slate-200"}),e("div",{class:"flex-1 min-w-0"},[e("div",{class:"h-5 w-32 animate-pulse rounded bg-slate-200"}),e("div",{class:"mt-2 flex gap-1"},[e("div",{class:"h-5 w-12 animate-pulse rounded-md bg-slate-100"}),e("div",{class:"h-5 w-8 animate-pulse rounded-md bg-slate-100"}),e("div",{class:"h-5 w-8 animate-pulse rounded-md bg-slate-100"})])]),e("div",{class:"text-right"},[e("div",{class:"h-5 w-20 animate-pulse rounded bg-slate-200"}),e("div",{class:"mt-1 h-5 w-16 animate-pulse rounded-md bg-slate-100"})])]),e("div",{class:"mt-3 flex items-center justify-between"},[e("div",{class:"h-4 w-32 animate-pulse rounded bg-slate-100"}),e("div",{class:"h-4 w-24 animate-pulse rounded bg-slate-100"})])],-1)])])),64))],2)):h.value.length?(o(),d("div",{key:1,class:x(m(p)?"mt-4 space-y-3 pb-8":"mt-5 grid grid-cols-2 gap-4 pb-10 xl:grid-cols-3")},[(o(!0),d(P,null,z(H.value,s=>(o(),U(m(R),{key:s.id,href:a.route("credit-cards.show",{account:s.id}),class:"block overflow-hidden rounded-2xl bg-white shadow-sm ring-1 ring-slate-200/60"},{default:D(()=>[e("div",ke,[e("div",Ce,[_(ce,{institution:s.banco??s.displayName,"svg-path":s.svgPath,"fallback-icon":"credit-card","container-class":"flex h-12 w-12 shrink-0 items-center justify-center overflow-hidden rounded-2xl bg-white","img-class":"h-10 w-10 object-contain","fallback-icon-class":"h-6 w-6 text-white",style:j(s.svgPath?void 0:{backgroundColor:s.cor})},null,8,["institution","svg-path","style"]),e("div",De,[e("div",Me,c(s.displayName),1),e("div",Se,[s.bandeira?(o(),d("span",Be,c(String(s.bandeira)),1)):M("",!0)])]),e("div",Ae,[e("div",$e,c(k(s.usado)),1),e("div",{class:x(["mt-1 inline-block rounded-md px-2 py-0.5 text-[10px] font-bold uppercase tracking-wide",Y(s.status)])},c(s.status),3)])]),e("div",Ne,[e("div",Fe,[e("span",null,"LIMITE USADO: "+c(Math.round(s.percentualUsado))+"%",1),e("span",null,"DISP: "+c(k(s.disponivel)),1)]),e("div",je,[e("div",{class:"h-full rounded-full transition-all duration-300",style:j({width:`${Math.min(s.percentualUsado,100)}%`,backgroundColor:s.cor})},null,4)]),e("div",Pe,[e("div",Ve,[s.fechamentoDia?(o(),d("span",{key:0,class:"inline-flex items-center gap-1",title:`Fechamento dia ${s.fechamentoDia}`},[t[14]||(t[14]=e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 2v4"}),e("path",{d:"M16 2v4"}),e("path",{d:"M3 10h18"}),e("path",{d:"M5 6h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"})],-1)),L(" FECHA DIA "+c(String(s.fechamentoDia).padStart(2,"0")),1)],8,Ee)):M("",!0),s.vencimentoDia?(o(),d("span",{key:1,class:"inline-flex items-center gap-1",title:`Vencimento dia ${s.vencimentoDia}`},[t[15]||(t[15]=e("svg",{class:"h-4 w-4 text-slate-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M8 2v4"}),e("path",{d:"M16 2v4"}),e("path",{d:"M3 10h18"}),e("path",{d:"M5 6h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2Z"}),e("path",{d:"M12 14v4"}),e("path",{d:"M12 12h.01"})],-1)),L(" VENCE DIA "+c(String(s.vencimentoDia).padStart(2,"0")),1)],8,Ie)):M("",!0)])])])])]),_:2},1032,["href"]))),128))],2)):(o(),d("div",Ue,[...t[16]||(t[16]=[e("div",{class:"text-sm font-semibold text-slate-900"},"Nenhum cartão cadastrado",-1),e("div",{class:"mt-1 text-xs text-slate-500"},"Adicione um cartão para começar",-1)])]))],2),_(oe,{open:b.value,onClose:t[3]||(t[3]=s=>b.value=!1),onSave:Z},null,8,["open"])]),_:2},[m(p)?void 0:{name:"headerActions",fn:D(()=>[e("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Adicionar cartão",onClick:t[0]||(t[0]=s=>b.value=!0)},[...t[4]||(t[4]=[e("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e("line",{x1:"5",y1:"12",x2:"19",y2:"12"})],-1)])])]),key:"0"}]),1040))],64))}});export{qe as default};
