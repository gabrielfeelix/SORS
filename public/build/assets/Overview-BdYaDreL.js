import{d as pe,c as d,u as he,h as i,z as be,p as ee,g as c,f as h,a as te,b as x,D as ge,E as we,w as T,e as t,i as y,o as r,A as se,l as ae,n as G,t as b,F as J,r as ne,j as xe,G as ye,H as ke,C as Ce}from"./app-DvJ-vTb0.js";import{u as Me,_ as _e}from"./useIsMobile-CMH_TBsk.js";import{_ as De,r as Y}from"./DesktopShell.vue_vue_type_script_setup_true_lang-BVoVaQ94.js";import{_ as $e}from"./CreateAccountFlowModal.vue_vue_type_script_setup_true_lang-DzQ56nH9.js";import{_ as Se}from"./CreateCreditCardFlowModal.vue_vue_type_script_setup_true_lang-lP2gGW5r.js";import{_ as Be}from"./CreditCardModal.vue_vue_type_script_setup_true_lang-BAYISiSL.js";import{_ as Ne}from"./MobileToast.vue_vue_type_script_setup_true_lang-C8uRLjf5.js";import{_ as Ae}from"./MonthNavigator.vue_vue_type_script_setup_true_lang-BF8bI4Ys.js";import{T as Fe,e as Te}from"./TransactionModal-CAPdfSRY.js";import"./inputGuards-BTKUKM9N.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"flex items-center gap-2"},Oe={class:"relative"},je={key:0,class:"flex items-center justify-between pt-2"},Re={class:"flex items-center gap-2"},Ve={class:"relative"},Le={class:"mt-6"},Ee={class:"grid grid-cols-2 divide-x divide-slate-100"},Pe={class:"px-4 py-4 text-center"},Ie={class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},Ke={class:"px-4 py-4 text-center"},He={class:"mt-8 pb-[calc(2rem+env(safe-area-inset-bottom))]"},Ge={class:"flex items-center justify-between"},Je={key:0,class:"h-4 w-20 animate-pulse rounded bg-slate-200"},Ye={key:1,class:"text-xs font-bold text-emerald-600"},qe={key:0,class:"mt-4 space-y-3"},Ue={key:1,class:"mt-4 space-y-3"},We={class:"flex items-center gap-3"},Qe={key:0,class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Xe={key:1,class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},Ze={class:"text-sm font-semibold text-slate-900"},et={class:"flex flex-wrap items-center gap-1 text-[11px] font-semibold uppercase tracking-wide text-slate-400"},tt={key:0},st={key:1},at={class:"text-sm font-semibold text-slate-900"},bt=pe({__name:"Overview",setup(nt){const k=Me(),oe=d(()=>k.value?_e:De),le=d(()=>k.value?{showNav:!1}:{title:"Minhas Contas",subtitle:"Resumo",showSearch:!1,showNewAction:!1}),re=he(),z=d(()=>re.props.bootstrap??{entries:[],goals:[],accounts:[],categories:[],tags:[]}),O=d(()=>{const s=new Date,e=[];for(let a=-120;a<=120;a+=1){const n=new Date(s.getFullYear(),s.getMonth()+a,1),o=new Intl.DateTimeFormat("pt-BR",{month:"short"}).format(n).replace(".","").toUpperCase();e.push({key:`${n.getFullYear()}-${n.getMonth()}`,label:o,date:n})}return e}),v=i(""),m=i(new Map),j=i(new Map),g=i(new Map),C=i(new Map);be(()=>{const s=`${new Date().getFullYear()}-${new Date().getMonth()}`;v.value=O.value.find(e=>e.key===s)?.key??O.value[0]?.key??""}),ee(v,s=>{s&&R(s)},{immediate:!0});const M=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(s),ie=d(()=>{const s=new Map;for(const e of z.value.categories??[]){const a=e.type==="income"?"income":e.type==="expense"?"expense":void 0,n=s.get(e.name),o=n?.kind&&a&&n.kind!==a?void 0:n?.kind??a;s.set(e.name,{key:e.name,label:e.name,icon:"other",tone:"slate",kind:o})}return Array.from(s.values())}),ue=d(()=>{const s=e=>{const a=e.toLowerCase();return a.includes("nubank")?"purple":a.includes("inter")?"amber":a.includes("carteira")||a.includes("dinheiro")?"emerald":"slate"};return(z.value.accounts??[]).filter(e=>e.type!=="credit_card").map(e=>({key:e.name,label:e.name,subtitle:e.type==="wallet"?"Carteira":"Conta",tone:s(e.name),type:e.type,balance:Number(e.current_balance??0),customColor:e.color??void 0,icon:e.icon??void 0}))}),_=i(!1),q=i("transfer"),U=i(null),W=()=>{q.value="transfer",U.value=null,_.value=!0},de=async s=>{if(s.kind==="transfer")try{await Te(s),w("Transferência realizada"),_.value=!1,v.value&&R(v.value)}catch{w("Não foi possível realizar a transferência")}},R=async s=>{const e=s,a=`cards-${s}`;m.value.delete(e),m.value.delete(a),j.value.delete(e),C.value.delete(e),g.value.set(s,!0);try{const[n,o]=s.split("-").map(Number),[l,f]=await Promise.all([Y(`/api/contas-by-month?year=${n}&month=${o}`,{method:"GET"}),Y(`/api/cartoes-by-month?year=${n}&month=${o}`,{method:"GET"})]),N=l?.accounts??l?.contas??[];m.value.set(e,Array.isArray(N)?N:[]);const A=String(l?.mode??"");A&&j.value.set(e,A);const F=Number(l?.balanco??NaN);Number.isFinite(F)&&C.value.set(e,F);const u=f?.cartoes??f?.cards??[];m.value.set(a,Array.isArray(u)?u:[])}catch(n){console.error("Failed to load accounts for month",n),m.value.set(e,[]),m.value.set(a,[]),C.value.set(e,0)}finally{g.value.set(s,!1)}},Q=d(()=>{const s=v.value;return!s||g.value.get(s)?[]:m.value.has(s)?(m.value.get(s)??[]).filter(n=>(n.type??n.tipo)!=="credit_card").map(n=>{const o=n.type??n.tipo;return{id:n.id,name:n.name??n.nome,subtitle:n.subtitle??n.subtitulo??(o==="wallet"?"Dinheiro físico":o==="bank"?"Corrente":"Conta"),balance:Number(n.current_balance??n.saldo_atual??n.saldo??0),color:n.color??n.cor??"#14B8A6",icon:n.icon??n.icone??(o==="wallet"?"wallet":"bank"),hasData:!!(n.has_data??!0),balanceKind:String(n.balance_kind??"")}}):[]}),X=d(()=>{const s=v.value,e=`cards-${s}`;return!s||g.value.get(s)?[]:m.value.has(e)?(m.value.get(e)??[]).map(o=>({id:o.id,name:o.name??o.nome,balance:Math.max(0,Number(o.limite_usado??o.current_balance??0)),limit:Number(o.limite??o.credit_limit??0),color:o.cor??o.color??"#8B5CF6",brand:o.bandeira??o.card_brand??"visa",closingDay:Number(o.dia_fechamento??o.closing_day??0)||null,dueDay:Number(o.dia_vencimento??o.due_day??0)||null})):[]});d(()=>{const s=o=>String(o??"").trim().toLowerCase(),e=new Map;for(const o of X.value){const l=s(o.name),f=e.get(l)??[];f.push(o),e.set(l,f)}const a=[];for(const[o,l]of e.entries()){if(l.length===1){a.push({...l[0],displayName:l[0].name});continue}const f=[...l].sort((u,H)=>String(u.id).localeCompare(String(H.id))),N=new Set(f.map(u=>String(u.brand??"").toLowerCase())).size>1,A=new Set(f.map(u=>u.dueDay??null)).size>1,F=new Set(f.map(u=>u.closingDay??null)).size>1;f.forEach((u,H)=>{const fe=N||A||F?u.name:`${u.name} (${H+1})`;a.push({...u,displayName:fe})})}const n=new Map(X.value.map((o,l)=>[String(o.id),l]));return a.sort((o,l)=>(n.get(String(o.id))??0)-(n.get(String(l.id))??0))});const V=d(()=>Q.value.reduce((s,e)=>s+e.balance,0)),L=d(()=>{const s=v.value;return s?C.value.get(s)??0:0}),ce=d(()=>D.value==="past"?"Final do mês":D.value==="future"?"Saldo previsto":"Saldo atual"),D=d(()=>{const s=v.value;return s?String(j.value.get(s)??""):""}),E=d(()=>{const s=v.value;return s?g.value.get(s)??!1:!1}),P=i(!1),Z=i(""),w=s=>{Z.value=s,P.value=!0},$=i(!1),S=i(!1),I=i(!1),K=i(!1),p=i(!1),B=s=>{p.value=!1,s==="bank"?(S.value=!1,$.value=!0):s==="wallet"?(S.value=!0,$.value=!0):s==="card"&&(K.value=!0)},ve=()=>{window.location.reload()},me=async s=>{try{await Y("/api/cartoes",{method:"POST",body:JSON.stringify({...s,icone:"credit-card"})}),w("Cartão adicionado com sucesso!"),I.value=!1,window.location.reload()}catch{w("Não foi possível adicionar o cartão")}};return ee(()=>v.value,s=>{s&&R(s)}),(s,e)=>(r(),c(J,null,[h(x(ge),{title:"Minhas Contas"}),(r(),te(Ce(oe.value),ye(ke(le.value)),we({default:T(()=>[x(k)?(r(),c("header",je,[h(x(ae),{href:s.route("dashboard"),class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Voltar"},{default:T(()=>[...e[18]||(e[18]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),_:1},8,["href"]),e[21]||(e[21]=t("div",{class:"text-center"},[t("div",{class:"text-lg font-semibold text-slate-900"},"Minhas Contas")],-1)),t("div",Re,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Transferência",onClick:W},[...e[19]||(e[19]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 8h11"}),t("path",{d:"M12 5l3 3-3 3"}),t("path",{d:"M20 16H9"}),t("path",{d:"M12 13l-3 3 3 3"})],-1)])]),t("div",Ve,[t("button",{type:"button",class:"flex h-10 w-10 items-center justify-center rounded-2xl bg-white text-slate-600 shadow-sm ring-1 ring-slate-200/60","aria-label":"Menu",onClick:e[5]||(e[5]=a=>p.value=!p.value)},[...e[20]||(e[20]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},[t("circle",{cx:"12",cy:"5",r:"2"}),t("circle",{cx:"12",cy:"12",r:"2"}),t("circle",{cx:"12",cy:"19",r:"2"})],-1)])]),p.value?(r(),c("div",{key:0,class:"fixed inset-0 z-[65]",onClick:e[9]||(e[9]=a=>p.value=!1)},[t("div",{class:"absolute right-5 top-16 w-56 overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-slate-200/70",onClick:e[8]||(e[8]=se(()=>{},["stop"]))},[t("button",{type:"button",class:"w-full text-left rounded-t-2xl border-b border-slate-100 px-4 py-3 text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[6]||(e[6]=a=>B("bank"))}," Adicionar Conta Bancária "),t("button",{type:"button",class:"w-full text-left rounded-b-2xl px-4 py-3 text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[7]||(e[7]=a=>B("wallet"))}," Criar Carteira ")])])):y("",!0)])])])):y("",!0),t("div",Le,[h(Ae,{modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=a=>v.value=a),months:O.value},null,8,["modelValue","months"])]),t("div",{class:G(["mt-6 overflow-hidden rounded-3xl bg-white shadow-sm ring-1 ring-slate-200/60",E.value?"opacity-70":""])},[t("div",Ee,[t("div",Pe,[t("div",Ie,b(ce.value),1),t("div",{class:G(["mt-2 text-lg font-semibold",V.value>=0?"text-emerald-600":"text-red-500"])},b(M(V.value)),3)]),t("div",Ke,[e[22]||(e[22]=t("div",{class:"text-[10px] font-semibold uppercase tracking-wide text-slate-400"},"Balanço mensal",-1)),t("div",{class:G(["mt-2 text-lg font-semibold",L.value>=0?"text-emerald-600":"text-red-500"])},b(L.value>=0?"+":"-")+" "+b(M(Math.abs(L.value))),3)])])],2),t("section",He,[t("div",Ge,[e[23]||(e[23]=t("div",{class:"text-xs font-bold uppercase tracking-wide text-slate-400"},"Contas e carteiras",-1)),E.value?(r(),c("div",Je)):(r(),c("div",Ye,b(M(V.value)),1))]),E.value?(r(),c("div",qe,[(r(),c(J,null,ne(3,a=>t("div",{key:a,class:"flex items-center justify-between rounded-3xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},[...e[24]||(e[24]=[t("div",{class:"flex items-center gap-3"},[t("div",{class:"h-12 w-12 animate-pulse rounded-2xl bg-slate-200"}),t("div",null,[t("div",{class:"h-4 w-32 animate-pulse rounded bg-slate-200"}),t("div",{class:"mt-1 h-3 w-24 animate-pulse rounded bg-slate-100"})])],-1),t("div",{class:"h-4 w-20 animate-pulse rounded bg-slate-200"},null,-1)])])),64))])):(r(),c("div",Ue,[(r(!0),c(J,null,ne(Q.value,a=>(r(),te(x(ae),{key:a.id,href:s.route("accounts.show",{accountKey:a.id}),class:"flex items-center justify-between rounded-3xl bg-white px-4 py-4 shadow-sm ring-1 ring-slate-200/60"},{default:T(()=>[t("div",We,[t("span",{class:"flex h-12 w-12 items-center justify-center rounded-2xl text-white",style:xe({backgroundColor:a.color})},[a.icon==="wallet"?(r(),c("svg",Qe,[...e[25]||(e[25]=[t("path",{d:"M4 7h16v12H4z"},null,-1),t("path",{d:"M4 7V5h12v2"},null,-1),t("path",{d:"M16 12h4"},null,-1)])])):(r(),c("svg",Xe,[...e[26]||(e[26]=[t("path",{d:"M3 10h18"},null,-1),t("path",{d:"M5 10V8l7-5 7 5v2"},null,-1),t("path",{d:"M6 10v9"},null,-1),t("path",{d:"M18 10v9"},null,-1)])]))],4),t("div",null,[t("div",Ze,b(a.name),1),t("div",et,[t("span",null,b(a.subtitle),1),D.value==="past"&&a.hasData===!1?(r(),c("span",tt,"(SEM DADOS)")):y("",!0),D.value==="future"?(r(),c("span",st,"(PROJEÇÃO)")):y("",!0)])])]),t("div",at,b(M(a.balance)),1)]),_:2},1032,["href"]))),128))]))]),h(Ne,{show:P.value,message:Z.value,onDismiss:e[11]||(e[11]=a=>P.value=!1)},null,8,["show","message"]),h($e,{open:$.value,"start-with-wallet":S.value,onClose:e[12]||(e[12]=()=>{$.value=!1,S.value=!1}),onToast:w},null,8,["open","start-with-wallet"]),h(Se,{open:K.value,onClose:e[13]||(e[13]=a=>K.value=!1),onSave:ve},null,8,["open"]),h(Be,{open:I.value,onClose:e[14]||(e[14]=a=>I.value=!1),onSave:me},null,8,["open"]),h(Fe,{open:_.value,kind:q.value,initial:U.value,categories:ie.value,accounts:ue.value,tags:z.value.tags,onClose:e[15]||(e[15]=a=>_.value=!1),onSave:de},null,8,["open","kind","initial","categories","accounts","tags"])]),_:2},[x(k)?void 0:{name:"headerActions",fn:T(()=>[t("div",ze,[t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Transferência",onClick:W},[...e[16]||(e[16]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M4 8h11"}),t("path",{d:"M12 5l3 3-3 3"}),t("path",{d:"M20 16H9"}),t("path",{d:"M12 13l-3 3 3 3"})],-1)])]),t("div",Oe,[t("button",{type:"button",class:"flex h-11 w-11 items-center justify-center rounded-2xl bg-white text-slate-600 ring-1 ring-slate-200/60","aria-label":"Menu",onClick:e[0]||(e[0]=a=>p.value=!p.value)},[...e[17]||(e[17]=[t("svg",{class:"h-5 w-5",viewBox:"0 0 24 24",fill:"currentColor"},[t("circle",{cx:"12",cy:"5",r:"2"}),t("circle",{cx:"12",cy:"12",r:"2"}),t("circle",{cx:"12",cy:"19",r:"2"})],-1)])]),p.value?(r(),c("div",{key:0,class:"fixed inset-0 z-[65]",onClick:e[4]||(e[4]=a=>p.value=!1)},[t("div",{class:"absolute right-5 top-16 w-56 overflow-hidden rounded-2xl bg-white shadow-2xl ring-1 ring-slate-200/70",onClick:e[3]||(e[3]=se(()=>{},["stop"]))},[t("button",{type:"button",class:"w-full rounded-t-2xl border-b border-slate-100 px-4 py-3 text-left text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[1]||(e[1]=a=>B("bank"))}," Adicionar Conta Bancária "),t("button",{type:"button",class:"w-full rounded-b-2xl px-4 py-3 text-left text-sm font-semibold text-slate-900 hover:bg-slate-50",onClick:e[2]||(e[2]=a=>B("wallet"))}," Criar Carteira ")])])):y("",!0)])])]),key:"0"}]),1040))],64))}});export{bt as default};
